<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>4æ®µéšæ„›ç€è¨ºæ–­</title>
<!-- Chart.js for Radar -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
<style>
  :root{
    --rose50:#fff1f2; --rose100:#ffe4e6; --rose200:#fecdd3; --rose300:#fda4af;
    --rose400:#fb7185; --rose500:#f43f5e; --rose600:#e11d48;
    --ink:#334155; --muted:#64748b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,Arial,sans-serif;
    color:var(--ink);
    background:
      linear-gradient(#fff,#fff) 0 0/100% 88px no-repeat,
      repeating-linear-gradient(180deg,#fff5f6 0 64px,#fff 64px 128px);
  }
  .wrap{max-width:900px;margin:0 auto;padding:20px 16px 64px}
  h1{margin:6px 0 8px; text-align:center; font-weight:900; color:#be123c; font-size:clamp(22px,4.6vw,34px)}
  .sub{color:var(--muted); text-align:center; font-size:12px; margin-bottom:10px}
  .card{background:#fff;border:1px solid var(--rose200);border-radius:18px;padding:16px;box-shadow:0 1px 8px rgba(244,63,94,.08)}
  .row{display:flex;gap:12px;align-items:center;justify-content:space-between}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:640px){.grid2{grid-template-columns:1fr}}
  .qtitle{font-weight:800;color:#be123c;font-size:clamp(18px,3.8vw,24px);line-height:1.6;margin:6px 2px 10px}
  .stage{font-weight:700;color:#e11d48;font-size:14px;margin-bottom:6px}
  .choice{border:1px solid var(--rose200);border-radius:14px;padding:14px;text-align:left;background:#fff;cursor:pointer}
  .choice:hover{border-color:var(--rose300)}
  .choice.selected{border-color:var(--rose400);background:var(--rose50)}
  .btn{border:none;border-radius:12px;padding:11px 16px;font-weight:700;cursor:pointer}
  .btn-primary{background:var(--rose500);color:#fff}
  .btn-primary[disabled]{background:#fecaca;cursor:not-allowed}
  .btn-ghost{background:#fff;color:#e11d48;border:1px solid var(--rose200)}
  .muted{color:var(--muted); font-size:12px}
  .progress{margin:0 0 12px}
  .progress .row{margin-bottom:6px}
  .meter{height:10px;background:var(--rose100);border-radius:999px;overflow:hidden}
  .meter>i{display:block;height:100%;width:0;background:var(--rose400);transition:width .2s}
  .intro h2{margin:4px 0 8px; color:#be123c}
  .intro p{color:#6b7280; line-height:1.9; margin:6px 0}
  .pill{display:inline-block;border:1px solid var(--rose200);border-radius:999px;padding:6px 10px;font-size:12px;color:#be123c;background:#fff}
</style>
</head>
<body>
<div class="wrap">
  <h1>4æ®µéšæ„›ç€è¨ºæ–­</h1>
  <div id="progress" class="card progress">
    <div class="row">
      <div class="muted">é€²æ—</div>
      <div id="counter" class="muted">0/0 (0%)</div>
    </div>
    <div class="meter"><i id="bar"></i></div>
  </div>

  <div id="screen" class="card"></div>
</div>

<script>
/* ============================================================
   è³ªå•ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
   - type: "intro" | "q"
   - For Stage1: é¸æŠè‚¢ã”ã¨ã« aff="A|B|C|D"ï¼ˆA=ä¸å®‰/B=å›é¿/C=æã‚Œå›é¿/D=å®‰å®šï¼‰
   - For Stage2: A=0, B=1, C=2, D=3ï¼ˆæˆé•·ã‚¹ã‚³ã‚¢ï¼‰
   - For Stage3: A=0, B=1, C=2, D=3ï¼ˆå®‰å®šã‚¹ã‚³ã‚¢ï¼‰
   - For Stage4: 10ãƒ†ãƒ¼ãƒÃ—A(æ™®æ®µ)/B(æ‹æ„›ä¸­)ã€‚å„å•ã¯ role:"A" or "B", pairId åŒä¸€ã§ãƒšã‚¢ã«ã€‚
     é¸æŠè‚¢ã¯ A..D ã‚’ 0..3 ã‚¹ã‚³ã‚¢ã«ãƒãƒƒãƒ—ã—ã€B - A ã®ã‚®ãƒ£ãƒƒãƒ—ã‚’è©•ä¾¡ï¼ˆæ‹æ„›ä¸­ã§æ‚ªåŒ–=éš ã‚Œãƒªã‚¹ã‚¯ï¼‰
============================================================ */

/* ====== ç¬¬1æ®µéšï¼ˆS1ï¼‰â€”â€”ã„ã¾ã¯ã‚µãƒ³ãƒ—ãƒ«3å•ã€‚â˜…ã“ã“ã‚’å‰å›ã®ã€Œ60å•ç‰ˆã€ã«ç½®ãæ›ãˆã¦ãã ã•ã„ï¼ ====== */
const S1 = [
  {stage:1,type:"q",stem:"éå»ã®æ‹æ„›ã§ã€å¥½ããªäººã‹ã‚‰è¿”ä¿¡ãŒé…ã‚ŒãŸã¨ãã€ã©ã†ã—ã¦ã„ã¾ã—ãŸã‹ï¼Ÿ",
   choices:[
     {id:"A",label:"ä¸å®‰ãŒå¼·ã¾ã‚Šã€ç›¸æ‰‹ã®åå¿œã°ã‹ã‚Šæ°—ã«ãªã£ãŸ", aff:"A"},
     {id:"B",label:"æœŸå¾…ã—ã¦å‚·ã¤ã‹ãªã„ã‚ˆã†ã«è·é›¢ã‚’å–ã£ãŸ", aff:"B"},
     {id:"C",label:"è¿‘ã¥ããŸã„ã®ã«æ€–ãã¦å‹•ã‘ãªã‹ã£ãŸ", aff:"C"},
     {id:"D",label:"çŠ¶æ³ã‚’å—ã‘æ­¢ã‚ã¦è½ã¡ç€ã„ã¦å¾…ã¦ãŸ", aff:"D"},
   ]},
  {stage:1,type:"q",stem:"æ‹äººã¨ã‚±ãƒ³ã‚«ã«ãªã£ãŸã¨ãã€æœ€ã‚‚å¤šã„è¡Œå‹•ã¯ï¼Ÿ",
   choices:[
     {id:"A",label:"æ„Ÿæƒ…çš„ã«ã¶ã¤ã‹ã£ã¦ã—ã¾ã£ãŸ", aff:"A"},
     {id:"B",label:"ç„¡è¦–/é€£çµ¡ã‚’æ¸›ã‚‰ã—ã¦è·é›¢ã‚’å–ã£ãŸ", aff:"B"},
     {id:"C",label:"ä½•ã‚‚è¨€ãˆãšæˆ‘æ…¢ã—ã¦ã—ã¾ã£ãŸ", aff:"C"},
     {id:"D",label:"ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹ã¦å†·é™ã«è©±ã—åˆã£ãŸ", aff:"D"},
   ]},
  {stage:1,type:"q",stem:"ç›¸æ‰‹ãŒã€ä¸€äººã®æ™‚é–“ãŒæ¬²ã—ã„ã€ã¨è¨€ã£ãŸã¨ãã€ã‚ãªãŸã¯ï¼Ÿ",
   choices:[
     {id:"A",label:"å«Œã‚ã‚ŒãŸä¸å®‰ã§ç¢ºèªé€£çµ¡ãŒå¢—ãˆãŸ", aff:"A"},
     {id:"B",label:"ã€ã˜ã‚ƒã‚ç§ã‚‚ã€ã¨è·é›¢ã‚’åºƒã’ãŸ", aff:"B"},
     {id:"C",label:"è¡¨é¢ã¯å—ã‘å…¥ã‚ŒãŸãŒå†…å¿ƒã¯å¯‚ã—ã‹ã£ãŸ", aff:"C"},
     {id:"D",label:"å¿…è¦ãªæ™‚é–“ã ã¨ç†è§£ã—ä»»ã›ã‚‰ã‚ŒãŸ", aff:"D"},
   ]},
];

/* ====== ç¬¬2æ®µéšï¼ˆS2 20å•ï¼‰A:å¤‰åŒ–ãªã—â†’D:ã»ã¼å®‰å®š ====== */
const S2_INTRO = {type:"intro",stage:2,title:"ç¬¬2æ®µéšï¼šæˆé•·ãƒ»æ”¹å–„åº¦",
  body:[
    "ã“ã“ã§ã¯ã€Œæ˜”ã®è‡ªåˆ†ã€ã¨ã€Œä»Šã®è‡ªåˆ†ã€ã‚’æ¯”ã¹ã¾ã™ã€‚",
    "Aã¯å¤‰åŒ–ãŒå°‘ãªãã€Dã«è¿‘ã„ã»ã©æ”¹å–„ãƒ»è‡ªç«‹ãŒé€²ã‚“ã§ã„ã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ã€‚",
    "è½ã¡ç€ã„ã¦ã€æ­£ç›´ã«é¸ã‚“ã§ãã ã•ã„ã€‚"
  ]};

const S2 = [
  {id:"s2-01",stage:2,type:"q",stem:"æ„›ç€ã‚’æ„è­˜ã™ã‚‹å‰ã¨æ¯”ã¹ã¦ã€ä¸å®‰ã‚’æ„Ÿã˜ã‚‹é »åº¦ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¨ã‚“ã©å¤‰ã‚ã‚‰ãªã„"},{id:"B",label:"å°‘ã—æ¸›ã£ãŸ"},{id:"C",label:"ã‹ãªã‚Šæ¸›ã£ãŸ"},{id:"D",label:"ã‚ã£ãŸã«ä¸å®‰ã«ãªã‚‰ãªã„"}]},
  {id:"s2-02",stage:2,type:"q",stem:"æ˜”ã¨æ¯”ã¹ã¦ã€ç›¸æ‰‹ã‚’ä¿¡ã˜ã‚‰ã‚Œã‚‹åº¦åˆã„ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¼å¤‰åŒ–ãªã—"},{id:"B",label:"å°‘ã—ä¿¡ã˜ã‚‰ã‚Œã‚‹"},{id:"C",label:"ã‹ãªã‚Šä¿¡ã˜ã‚‰ã‚Œã‚‹"},{id:"D",label:"åŸºæœ¬çš„ã«ä¿¡é ¼ã§ãã¦ã„ã‚‹"}]},
  {id:"s2-03",stage:2,type:"q",stem:"ä¸å®‰ã«ãªã£ãŸã¨ãã€è½ã¡ç€ãã¾ã§ã®æ™‚é–“ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ä»¥å‰ã¨åŒã˜ï¼é•·å¼•ã"},{id:"B",label:"å°‘ã—çŸ­ã"},{id:"C",label:"ã‹ãªã‚ŠçŸ­ã"},{id:"D",label:"ã™ãæ•´ãˆã‚‰ã‚Œã‚‹"}]},
  {id:"s2-04",stage:2,type:"q",stem:"ç›¸æ‰‹ã«ç´ ç›´ã«æ°—æŒã¡ã‚’ä¼ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¼å¤‰åŒ–ãªã—"},{id:"B",label:"å°‘ã—è¨€ãˆã‚‹"},{id:"C",label:"ã‹ãªã‚Šè¨€ãˆã‚‹"},{id:"D",label:"è½ã¡ç€ã„ã¦ç‡ç›´ã«ä¼ãˆã‚‰ã‚Œã‚‹"}]},
  {id:"s2-05",stage:2,type:"q",stem:"ä¾å­˜çš„ãªè¡Œå‹•ï¼ˆè¿½æ’ƒLINEãªã©ï¼‰ã¯æ¸›ã‚Šã¾ã—ãŸã‹ï¼Ÿ",
    choices:[{id:"A",label:"ä»Šã‚‚ã‚ˆãã‚ã‚‹"},{id:"B",label:"å°‘ã—æ¸›ã£ãŸ"},{id:"C",label:"ã‹ãªã‚Šæ¸›ã£ãŸ"},{id:"D",label:"ã»ã¼ç„¡ã„"}]},
  {id:"s2-06",stage:2,type:"q",stem:"å¥½ããªäººã‹ã‚‰3æ—¥é€£çµ¡ãŒãªã‹ã£ãŸã‚‰ã€ä»Šã®ã‚ãªãŸã¯ï¼Ÿ",
    choices:[{id:"A",label:"é€£æŠ•ã—ã¦ã—ã¾ã†"},{id:"B",label:"æŠ‘ãˆã‚‰ã‚Œã‚‹ã“ã¨ã‚‚ã‚ã‚‹"},{id:"C",label:"è‡ªåˆ†ã‚’æ•´ãˆã¦å¾…ã¦ã‚‹"},{id:"D",label:"çŠ¶æ³ã‚’æ‰ãˆç›´ã—è½ã¡ç€ã„ã¦å¾…ã¦ã‚‹"}]},
  {id:"s2-07",stage:2,type:"q",stem:"ã€ä¸€äººã®æ™‚é–“ãŒæ¬²ã—ã„ã€ã¨è¨€ã‚ã‚ŒãŸã‚‰ï¼Ÿ",
    choices:[{id:"A",label:"ä¸å®‰ã§è©°ã‚ã‚‹"},{id:"B",label:"ä¸€æ—¦å—ã‘æ­¢ã‚ã‚‰ã‚Œã‚‹"},{id:"C",label:"æ„å›³ã‚’ç¢ºã‹ã‚è½ã¡ç€ã‘ã‚‹"},{id:"D",label:"è‡ªç„¶ã«å°Šé‡ã§ãã‚‹"}]},
  {id:"s2-08",stage:2,type:"q",stem:"ã‚±ãƒ³ã‚«ã—ãŸã¨ãã€ä»Šã®ã‚ãªãŸã¯ï¼Ÿ",
    choices:[{id:"A",label:"æ„Ÿæƒ…çš„/ç„¡è¦–ã«èµ°ã‚‹"},{id:"B",label:"ä¸€å‘¼å¸ç½®ã‘ã‚‹"},{id:"C",label:"è½ã¡ç€ã„ã¦è©±ã—åˆã„ã«æˆ»ã›ã‚‹"},{id:"D",label:"åˆæ„å½¢æˆã¾ã§é‹ã¹ã‚‹"}]},
  {id:"s2-09",stage:2,type:"q",stem:"ç›¸æ‰‹ãŒä»–ã®ç•°æ€§ã¨ä»²è‰¯ãã—ã¦ã„ã‚‹ã®ã‚’è¦‹ãŸã‚‰ï¼Ÿ",
    choices:[{id:"A",label:"è©°ã‚ã‚‹/è·é›¢ã‚’å–ã‚‹"},{id:"B",label:"ä¸å®‰ã ãŒãã®å ´ã¯æµã›ã‚‹"},{id:"C",label:"å¾Œã§å†·é™ã«å…±æœ‰ã§ãã‚‹"},{id:"D",label:"ä¿¡é ¼ã‚’å‰æã«å¯¾è©±ã§ãã‚‹"}]},
  {id:"s2-10",stage:2,type:"q",stem:"ä¸å®‰ãŒå‡ºã¦ã‚‚è‡ªåˆ†ã§è½ã¡ç€ã‘ã‚‹æ–¹æ³•ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¨ã‚“ã©ç„¡ã„"},{id:"B",label:"ã‚ã‚‹ãŒæ™‚ã€…å´©ã‚Œã‚‹"},{id:"C",label:"ååˆ†ã‚ã‚‹"},{id:"D",label:"ç¢ºç«‹ã—ã¦å†ç¾æ€§ãŒé«˜ã„"}]},
  {id:"s2-11",stage:2,type:"q",stem:"èª°ã«ã‚‚ç›¸è«‡ã§ããªã„ã¨ãã§ã‚‚ã€å†·é™ã•ã‚’ä¿ã¦ã‚‹è‡ªä¿¡ã¯ï¼Ÿ",
    choices:[{id:"A",label:"è‡ªä¿¡ãŒãªã„"},{id:"B",label:"çŠ¶æ³æ¬¡ç¬¬"},{id:"C",label:"ã»ã¼ä¿ã¦ã‚‹"},{id:"D",label:"ååˆ†ã«ä¿ã¦ã‚‹"}]},
  {id:"s2-12",stage:2,type:"q",stem:"æ‹æ„›ä»¥å¤–ï¼ˆä»•äº‹ãƒ»è¶£å‘³ï¼‰ã‚’å¤§åˆ‡ã«ã§ãã¦ã„ã¾ã™ã‹ï¼Ÿ",
    choices:[{id:"A",label:"ã§ãã¦ã„ãªã„"},{id:"B",label:"å°‘ã—æ„è­˜"},{id:"C",label:"æ¦‚ã­ã§ãã¦ã„ã‚‹"},{id:"D",label:"å®‰å®šã—ã¦ã§ãã¦ã„ã‚‹"}]},
  {id:"s2-13",stage:2,type:"q",stem:"ç›¸æ‰‹ãŒã„ãªãã¦ã‚‚ã€è‡ªåˆ†ã«ã¯ä¾¡å€¤ãŒã‚ã‚‹ã€ã¨æ€ãˆã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ã¾ã‚Šæ€ãˆãªã„"},{id:"B",label:"æ™‚ã€…æ€ãˆã‚‹"},{id:"C",label:"ã ã„ãŸã„æ€ãˆã‚‹"},{id:"D",label:"ã—ã£ã‹ã‚Šæ€ãˆã¦ã„ã‚‹"}]},
  {id:"s2-14",stage:2,type:"q",stem:"æ‹æ„›ãŒãªãã¦ã‚‚ã€ç”Ÿæ´»ã‚„æ°—æŒã¡ã¯å®‰å®šã—ã¦ã„ã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ä¸å®‰å®šã«ãªã‚ŠãŒã¡"},{id:"B",label:"ã‚„ã‚„ä¸å®‰å®š"},{id:"C",label:"ãŠãŠã‚€ã­å®‰å®š"},{id:"D",label:"å®‰å®šã—ã¦ã„ã‚‹"}]},
  {id:"s2-15",stage:2,type:"q",stem:"ã€æ‹æ„›ãŒãªãã¦ã‚‚å¹¸ã›ã€ã¨æ€ãˆã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¼ç„¡ã„"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ã‚ˆãã‚ã‚‹"},{id:"D",label:"è‡ªç„¶ã«æ„Ÿã˜ã‚‰ã‚Œã‚‹"}]},
  {id:"s2-16",stage:2,type:"q",stem:"é ­ã§ã¯ã€å¤§ä¸ˆå¤«ã€ã§ã‚‚å¿ƒã¯ä¸å®‰ã€ãŒèµ·ãã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãã‚ã‚‹"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ã¾ã‚Œã«ã‚ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s2-17",stage:2,type:"q",stem:"çŸ¥è­˜ã§ã¯ç†è§£ã—ã¦ã„ã¦ã‚‚ä¸å®‰ãŒã¶ã‚Šè¿”ã™ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãã¶ã‚Šè¿”ã™"},{id:"B",label:"æ™‚ã€…ã¶ã‚Šè¿”ã™"},{id:"C",label:"ãŸã¾ã«ã‚ã‚‹"},{id:"D",label:"ã»ã¼ç„¡ã„"}]},
  {id:"s2-18",stage:2,type:"q",stem:"ã€å†·é™ã§ã„ã‚ˆã†ã€ã¨æ€ã£ã¦ã‚‚åŒã˜è¡Œå‹•ã‚’ç¹°ã‚Šè¿”ã™ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãç¹°ã‚Šè¿”ã™"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ã‹ãªã‚Šæ¸›ã£ãŸ"},{id:"D",label:"ã»ã¼ç„¡ã„"}]},
  {id:"s2-19",stage:2,type:"q",stem:"ã†ã¾ãã„ã‹ãªã„ã¨ãã€è‡ªåˆ†ã‚’è²¬ã‚ã¦ã—ã¾ã†ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãè²¬ã‚ã‚‹"},{id:"B",label:"æ™‚ã€…è²¬ã‚ã‚‹"},{id:"C",label:"ãŸã¾ã«ã‚ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s2-20",stage:2,type:"q",stem:"ã€æˆé•·ã—ãŸã¯ãšãªã®ã«æ‹æ„›ã§æºã‚‰ãã€ã¨æ„Ÿã˜ã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãæ„Ÿã˜ã‚‹"},{id:"B",label:"æ™‚ã€…æ„Ÿã˜ã‚‹"},{id:"C",label:"ã¾ã‚Œã«æ„Ÿã˜ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©æ„Ÿã˜ãªã„"}]},
];

/* ====== ç¬¬3æ®µéšï¼ˆS3 20å•ï¼‰A:ä¸å®‰å®šâ†’D:å®‰å®š ====== */
const S3_INTRO = {type:"intro",stage:3,title:"ç¬¬3æ®µéšï¼šæ”¹å–„ã®å®‰å®šåº¦",
  body:[
    "å¼·ã„ã‚¹ãƒˆãƒ¬ã‚¹çŠ¶æ³ã‚„â€œä¸€äººã®ã¨ãâ€ã§ã‚‚å®‰å®šã§ãã‚‹ã‹ã‚’æ¸¬ã‚Šã¾ã™ã€‚",
    "Aã¯æœ€ã‚‚ä¸å®‰å®šã€Dã¯æœ€ã‚‚å®‰å®šã€‚ç´ ç›´ã«ä»Šã®ã‚ãªãŸã§é¸æŠã—ã¦ãã ã•ã„ã€‚"
  ]};

const S3 = [
  {id:"s3-01",stage:3,type:"q",stem:"å¥½ããªäººã‹ã‚‰3æ—¥é–“é€£çµ¡ãŒãªã‹ã£ãŸã‚‰ï¼Ÿ",
    choices:[{id:"A",label:"é€£æŠ•/é›»è©±ã—ã¦ã—ã¾ã†"},{id:"B",label:"è½ã¡è¾¼ã‚€ãŒä¸€æ—¦å¾…ã¦ã‚‹"},{id:"C",label:"ä¸å®‰ã‚’æ•´ãˆæ§˜å­ã‚’è¦‹ã‚‹"},{id:"D",label:"çŠ¶æ³ã‚’æ‰ãˆç›´ã—è½ã¡ç€ã„ã¦å¾…ã¦ã‚‹"}]},
  {id:"s3-02",stage:3,type:"q",stem:"ã€å°‘ã—è·é›¢ã‚’ç½®ããŸã„ã€ã¨è¨€ã‚ã‚ŒãŸã‚‰ï¼Ÿ",
    choices:[{id:"A",label:"ãƒ‘ãƒ‹ãƒƒã‚¯ã§è©°ã‚ã‚‹/é€£æŠ•"},{id:"B",label:"å†·ã‚ãŸãƒ•ãƒª/é§†ã‘å¼•ã"},{id:"C",label:"ä¸å®‰ã¯ã‚ã‚‹ãŒè½ã¡ç€ã‘ã‚‹"},{id:"D",label:"å°Šé‡ã—è‡ªåˆ†ã®æ™‚é–“ã‚’æ•´ãˆã‚‰ã‚Œã‚‹"}]},
  {id:"s3-03",stage:3,type:"q",stem:"ç›¸æ‰‹ãŒå…ƒã‚«ãƒãƒ»å…ƒã‚«ãƒ¬ã®è©±ã‚’ã—ãŸã¨ãï¼Ÿ",
    choices:[{id:"A",label:"å•ã„è©°ã‚ã‚‹/å½“ãŸã‚‹"},{id:"B",label:"é»™ã‚‹/è·é›¢ã‚’å–ã‚‹"},{id:"C",label:"å¾Œã§è½ã¡ç€ã„ã¦å…±æœ‰"},{id:"D",label:"ä¿¡é ¼ã‚’å‰æã«å¯¾è©±"}]},
  {id:"s3-04",stage:3,type:"q",stem:"ç›¸æ‰‹ãŒæ€¥ã«å†·ãŸã„æ…‹åº¦ã«ãªã£ãŸã¨æ„Ÿã˜ãŸã‚‰ï¼Ÿ",
    choices:[{id:"A",label:"ç†ç”±ç¢ºèªã‚’é€£ç™º/æ„Ÿæƒ…çš„"},{id:"B",label:"æŠ•ã’ã‚„ã‚Š/è·é›¢ã‚’ç½®ã"},{id:"C",label:"ä¸€å‘¼å¸ãŠã„ã¦è½ã¡ç€ã"},{id:"D",label:"ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’è¦‹ã¦å†·é™ã«è©±ã™"}]},
  {id:"s3-05",stage:3,type:"q",stem:"ä¸å®‰ã§çœ ã‚Œãªããªã‚‹ã“ã¨ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãã‚ã‚‹"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ãŸã¾ã«ã‚ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s3-06",stage:3,type:"q",stem:"ç›¸è«‡ã§ããªã„çŠ¶æ³ã§ä¸å®‰ã«ãªã£ãŸã‚‰ï¼Ÿ",
    choices:[{id:"A",label:"æ„Ÿæƒ…ã«é£²ã¾ã‚Œè¡å‹•é€£çµ¡"},{id:"B",label:"æˆ‘æ…¢ã—ã¦è‹¦ã—ã¿ç¶šã‘ã‚‹"},{id:"C",label:"ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã§è½ã¡ç€ã‘ã‚‹"},{id:"D",label:"å®¢è¦³è¦–ã—ã¦è¡Œå‹•ã‚’é¸ã¹ã‚‹"}]},
  {id:"s3-07",stage:3,type:"q",stem:"æ‹äººãŒã„ãªã„æœŸé–“ã§ã‚‚æ°—æŒã¡ã¯å®‰å®šã—ã¦ã„ã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ä¸å®‰å®šã«ãªã‚Šã‚„ã™ã„"},{id:"B",label:"ã‚„ã‚„ä¸å®‰å®š"},{id:"C",label:"ãŠãŠã‚€ã­å®‰å®š"},{id:"D",label:"å®‰å®šã—ã¦ã„ã‚‹"}]},
  {id:"s3-08",stage:3,type:"q",stem:"èª°ã«ã‚‚é ¼ã‚Œãªã„ã¨ãã€è‡ªåˆ†ã§è½ã¡ç€ã‘ã‚‹æ–¹æ³•ãŒï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¨ã‚“ã©ç„¡ã„"},{id:"B",label:"ã‚ã‚‹ãŒä¸å®‰å®š"},{id:"C",label:"ååˆ†ã‚ã‚‹"},{id:"D",label:"å†ç¾æ€§é«˜ãä½¿ãˆã‚‹"}]},
  {id:"s3-09",stage:3,type:"q",stem:"ä¼‘æ—¥ã‚’ä¸€äººã§éã”ã™ã¨ã€æ‹æ„›ã®ã“ã¨ã°ã‹ã‚Šè€ƒãˆã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãã‚ã‚‹"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ãŸã¾ã«ã‚ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s3-10",stage:3,type:"q",stem:"SNSã§ä¸å®‰ã«ãªã‚‹ã“ã¨ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãã‚ã‚‹"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ãŸã¾ã«ã‚ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s3-11",stage:3,type:"q",stem:"æ‹æ„›ãŒå§‹ã¾ã‚‹ã¨ã€æ˜”ã®ä¸å®‰ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æˆ»ã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãæˆ»ã‚‹"},{id:"B",label:"æ™‚ã€…æˆ»ã‚‹"},{id:"C",label:"ã¾ã‚Œã«æˆ»ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s3-12",stage:3,type:"q",stem:"ç›¸æ‰‹ã‚’ç–‘ã£ã¦ã—ã¾ã†æ°—æŒã¡ã¯ï¼Ÿ",
    choices:[{id:"A",label:"å¼·ãå‡ºã‚„ã™ã„"},{id:"B",label:"æ™‚ã€…å‡ºã‚‹"},{id:"C",label:"ã¾ã‚Œã«å‡ºã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©å‡ºãªã„"}]},
  {id:"s3-13",stage:3,type:"q",stem:"ã‚±ãƒ³ã‚«ã®ã¨ãæ„Ÿæƒ…çš„ã«ãªã‚Šã‚„ã™ã„ï¼Ÿ",
    choices:[{id:"A",label:"ãªã‚Šã‚„ã™ã„"},{id:"B",label:"æ™‚ã€…ã‚ã‚‹"},{id:"C",label:"ã‚ã¾ã‚Šç„¡ã„"},{id:"D",label:"ã»ã¼ç„¡ã„"}]},
  {id:"s3-14",stage:3,type:"q",stem:"ä¸å®‰ã‚’æ„Ÿã˜ã‚‹ã¨ãã€è‡ªåˆ†ã®ä¾¡å€¤ã‚’ç–‘ã£ã¦ã—ã¾ã†ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãç–‘ã†"},{id:"B",label:"æ™‚ã€…ç–‘ã†"},{id:"C",label:"ãŸã¾ã«ã‚ã‚‹"},{id:"D",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"s3-15",stage:3,type:"q",stem:"ã€ã‚‚ã†å¤§ä¸ˆå¤«ã€ã¨æ€ã£ã¦ã‚‚ã€æ‹æ„›ä¸­ã«æºã‚‰ãï¼Ÿ",
    choices:[{id:"A",label:"ã‚ˆãæºã‚‰ã"},{id:"B",label:"æ™‚ã€…æºã‚‰ã"},{id:"C",label:"ã¾ã‚Œã«æºã‚‰ã"},{id:"D",label:"ã»ã¨ã‚“ã©æºã‚‰ãŒãªã„"}]},
  {id:"s3-16",stage:3,type:"q",stem:"ä¸å®‰ã‚’ã¶ã¤ã‘ãã†ã«ãªã£ã¦ã‚‚ã€è½ã¡ç€ã‘ã‚‹ã“ã¨ãŒå¢—ãˆãŸï¼Ÿ",
    choices:[{id:"A",label:"ã‚ã¾ã‚Šå¢—ãˆã¦ã„ãªã„"},{id:"B",label:"å°‘ã—å¢—ãˆãŸ"},{id:"C",label:"ã‹ãªã‚Šå¢—ãˆãŸ"},{id:"D",label:"å®‰å®šã—ã¦ã§ãã‚‹"}]},
  {id:"s3-17",stage:3,type:"q",stem:"ä¸€åº¦è½ã¡ç€ã‘ã°ã€ãã®å¾Œã‚‚å®‰å®šã‚’ä¿ã¡ã‚„ã™ã„ï¼Ÿ",
    choices:[{id:"A",label:"ä¿ã¦ãªã„ã“ã¨ãŒå¤šã„"},{id:"B",label:"çŠ¶æ³æ¬¡ç¬¬"},{id:"C",label:"ã ã„ãŸã„ä¿ã¦ã‚‹"},{id:"D",label:"ä¿ã¦ã‚‹è‡ªä¿¡ãŒã‚ã‚‹"}]},
  {id:"s3-18",stage:3,type:"q",stem:"ä¸å®‰ã‚’æ„Ÿã˜ãŸã¨ãã€ä»¥å‰ã‚ˆã‚Šå†·é™ã«è©±ã—åˆãˆã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ã¾ã‚Šå¤‰åŒ–ãªã—"},{id:"B",label:"å°‘ã—ã¯è©±ã›ã‚‹"},{id:"C",label:"ã‹ãªã‚Šè©±ã›ã‚‹"},{id:"D",label:"è½ã¡ç€ã„ã¦è©±ã—åˆãˆã‚‹"}]},
  {id:"s3-19",stage:3,type:"q",stem:"å¼·ã„å«‰å¦¬ã‚„ä¸å®‰ãŒå‡ºã¦ã‚‚ã€è‡ªåˆ†ã§ä¿®æ­£ã§ãã‚‹ï¼Ÿ",
    choices:[{id:"A",label:"ã»ã¼ã§ããªã„"},{id:"B",label:"æ™‚ã€…ã§ãã‚‹"},{id:"C",label:"å¤šãã¯ã§ãã‚‹"},{id:"D",label:"å®‰å®šã—ã¦ã§ãã‚‹"}]},
  {id:"s3-20",stage:3,type:"q",stem:"ã€å®‰å®šã—ãŸæ‹æ„›ã‚’ç¶šã‘ã‚‰ã‚Œã‚‹è‡ªä¿¡ã€ã¯ï¼Ÿ",
    choices:[{id:"A",label:"ã‚ã¾ã‚Šç„¡ã„"},{id:"B",label:"ã‚„ã‚„ã‚ã‚‹"},{id:"C",label:"ã‹ãªã‚Šã‚ã‚‹"},{id:"D",label:"ååˆ†ã‚ã‚‹"}]},
];

/* ====== ç¬¬4æ®µéšï¼ˆS4 20å•ï¼š10ãƒ†ãƒ¼ãƒÃ—A/Bï¼‰ ======
   - role:"A"=æ™®æ®µï¼ˆæ‹æ„›ã—ã¦ã„ãªã„æ™‚ï¼‰ã€role:"B"=æ‹æ„›ä¸­
   - åŒã˜ pairId ã® A/B ã‚’æ¯”è¼ƒã€‚0..3 ç‚¹ï¼ˆA=0,B=1,C=2,D=3ï¼‰ã§ã€ŒB-Aã€ãŒå¤§ãã„ã»ã©â€œæ‹æ„›æ™‚ã«æ‚ªåŒ–â€=éš ã‚Œãƒªã‚¹ã‚¯ã€‚
==================================================== */
const S4_INTRO = {type:"intro",stage:4,title:"ç¬¬4æ®µéšï¼šéš ã‚Œã‚¿ã‚¤ãƒ—è¨ºæ–­ï¼ˆã‚®ãƒ£ãƒƒãƒ—æ¸¬å®šï¼‰",
  body:[
    "æ™®æ®µã®è‡ªåˆ†ï¼ˆAï¼‰ã¨ã€æ‹æ„›ä¸­ã®è‡ªåˆ†ï¼ˆBï¼‰ã§â€œåŒã˜ãƒ†ãƒ¼ãƒâ€ã«ç­”ãˆã¾ã™ã€‚",
    "Bã§ã‚¹ã‚³ã‚¢ãŒæ‚ªåŒ–ï¼ˆAã‚ˆã‚Šä½ã„ï¼‰ã™ã‚‹ã»ã©ã€æ‹æ„›ãŒå§‹ã¾ã‚‹ã¨å‡ºã‚„ã™ã„éš ã‚Œãƒªã‚¹ã‚¯ãŒé«˜ã„ã¨åˆ¤å®šã—ã¾ã™ã€‚",
    "ç„¡ç†ã«è‰¯ãè¦‹ã›ãšã€å®Ÿæ„Ÿã«è¿‘ã„æ–¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚"
  ]};

const S4 = [
  // ãƒ†ãƒ¼ãƒ1ï¼šè¿”ä¿¡é…å»¶
  {id:"t1-A",pairId:"t1",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘ç›¸æ‰‹ã®è¿”ä¿¡ãŒé…ã„ã¨ãã®å¿ƒã®å‹•ãã¯ï¼Ÿ",
    choices:[{id:"D",label:"ã‚ã¾ã‚Šæ°—ã«ãªã‚‰ãªã„"},{id:"C",label:"å°‘ã—æ°—ã«ãªã‚‹ãŒåˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹"},{id:"B",label:"è½ã¡ç€ã‹ãªã„æ™‚ãŒã‚ã‚‹"},{id:"A",label:"ä¸å®‰ã§é ­ãŒå é ˜ã•ã‚Œã‚„ã™ã„"}]},
  {id:"t1-B",pairId:"t1",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘å¥½ããªäººã®è¿”ä¿¡ãŒé…ã„ã¨ãã®è¡Œå‹•ã¯ï¼Ÿ",
    choices:[{id:"D",label:"è½ã¡ç€ã„ã¦å¾…ã¦ã‚‹"},{id:"C",label:"æ°—ã«ã—ã¤ã¤ä»–ã®ã“ã¨ã«é›†ä¸­"},{id:"B",label:"ã‚¹ãƒãƒ›ã‚’ä½•åº¦ã‚‚ç¢ºèª"},{id:"A",label:"è¿½æ’ƒé€£çµ¡ã‚’é€ã£ã¦ã—ã¾ã†"}]},
  // ãƒ†ãƒ¼ãƒ2ï¼šä¸€äººã®æ™‚é–“
  {id:"t2-A",pairId:"t2",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘ã€ä¸€äººã®æ™‚é–“ã€ã‚’ã©ã†æ‰ãˆã‚‹ï¼Ÿ",
    choices:[{id:"D",label:"è‡ªç„¶ã«å¤§åˆ‡ã«ã§ãã‚‹"},{id:"C",label:"ã¾ã‚å¤§äº‹ã ã¨æ€ã†"},{id:"B",label:"ã‚„ã‚‹ã“ã¨ãŒç„¡ã„ã¨ä¸å®‰"},{id:"A",label:"ä¸€äººãŒè‹¦æ‰‹ã§è½ã¡ç€ã‹ãªã„"}]},
  {id:"t2-B",pairId:"t2",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘ç›¸æ‰‹ã«ã€ä¸€äººã®æ™‚é–“ãŒæ¬²ã—ã„ã€ã¨è¨€ã‚ã‚ŒãŸã‚‰ï¼Ÿ",
    choices:[{id:"D",label:"å°Šé‡ã—ã¦è‡ªåˆ†ã®æ™‚é–“ã«æˆ»ã‚‹"},{id:"C",label:"å°‘ã—ä¸å®‰ã§ã‚‚å—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹"},{id:"B",label:"å†…å¿ƒã‚¶ãƒ¯ã¤ãç¢ºèªã—ãŸããªã‚‹"},{id:"A",label:"ãƒ‘ãƒ‹ãƒƒã‚¯ã§è©°ã‚ã¦ã—ã¾ã†"}]},
  // ãƒ†ãƒ¼ãƒ3ï¼šSNS
  {id:"t3-A",pairId:"t3",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘SNSã®æ›´æ–°é †ã«å·¦å³ã•ã‚Œã‚‹ï¼Ÿ",
    choices:[{id:"D",label:"ã»ã¼å½±éŸ¿ã•ã‚Œãªã„"},{id:"C",label:"å°‘ã—ã–ã‚ã¤ãç¨‹åº¦"},{id:"B",label:"æ°—ã«ãªã‚Šã‚„ã™ã„"},{id:"A",label:"å¿ƒã‚’å¤§ããä¹±ã—ã‚„ã™ã„"}]},
  {id:"t3-B",pairId:"t3",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘ç›¸æ‰‹ãŒè‡ªåˆ†ã‚ˆã‚Šå…ˆã«SNSæ›´æ–°ã—ã¦è¿”ä¿¡ãŒç„¡ã„æ™‚ã¯ï¼Ÿ",
    choices:[{id:"D",label:"äº‹æƒ…ã¨åˆ‡ã‚Šåˆ†ã‘ã¦å—ã‘æ­¢ã‚ã‚‹"},{id:"C",label:"æ°—ã«ãªã‚‹ãŒæ§˜å­ã‚’è¦‹ã‚‹"},{id:"B",label:"ä¸å®‰ãŒå¼·ã¾ã‚ŠãŒã¡"},{id:"A",label:"å¼·ã„ä¸å®‰ã§ç¢ºèªé€£çµ¡ã‚’ã—ã¦ã—ã¾ã†"}]},
  // ãƒ†ãƒ¼ãƒ4ï¼šå«‰å¦¬
  {id:"t4-A",pairId:"t4",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘ä»–è€…ã¨ã®é›‘è«‡ã‚’è¦‹ã¦ã‚‚ï¼Ÿ",
    choices:[{id:"D",label:"ç‰¹ã«å‹•æºã—ãªã„"},{id:"C",label:"å°‘ã—æ°—ã«ãªã‚‹ç¨‹åº¦"},{id:"B",label:"ãƒ¢ãƒ¤ãƒ¢ãƒ¤ã‚’æŠ±ãˆã‚„ã™ã„"},{id:"A",label:"å¼·ã„å«‰å¦¬ã§é ­ãŒã„ã£ã±ã„"}]},
  {id:"t4-B",pairId:"t4",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘å¥½ããªäººãŒä»–ã®ç•°æ€§ã¨æ¥½ã—ãã†ã«è©±ã—ã¦ã„ãŸã‚‰ï¼Ÿ",
    choices:[{id:"D",label:"ä¿¡é ¼ã—è½ã¡ç€ã„ã¦ã„ã‚‰ã‚Œã‚‹"},{id:"C",label:"å¾Œã§ç©ã‚„ã‹ã«å…±æœ‰"},{id:"B",label:"ä¸æ©Ÿå«Œ/è·é›¢ã‚’å–ã‚‹"},{id:"A",label:"ãã®å ´ã§è©°ã‚ã‚‹/æ„Ÿæƒ…çš„ã«ãªã‚‹"}]},
  // ãƒ†ãƒ¼ãƒ5ï¼šã‚±ãƒ³ã‚«
  {id:"t5-A",pairId:"t5",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘æ„è¦‹ã®è¡çªãŒèµ·ããŸã¨ãï¼Ÿ",
    choices:[{id:"D",label:"è½ã¡ç€ã„ã¦è©±ã—åˆãˆã‚‹"},{id:"C",label:"ä¸€å‘¼å¸ãŠã‘ã‚‹"},{id:"B",label:"æ„Ÿæƒ…ãŒæºã‚Œã‚„ã™ã„"},{id:"A",label:"æ„Ÿæƒ…çš„/é»™ã‚Šè¾¼ã¿ãŒã¡"}]},
  {id:"t5-B",pairId:"t5",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘ã‚±ãƒ³ã‚«ã«ãªã£ãŸã¨ãï¼Ÿ",
    choices:[{id:"D",label:"åˆæ„å½¢æˆã¾ã§é‹ã¹ã‚‹"},{id:"C",label:"è½ã¡ç€ã„ã¦æˆ»ã›ã‚‹"},{id:"B",label:"ç„¡è¦–/è·é›¢/è©°ã‚ã‚‹"},{id:"A",label:"çˆ†ç™º/é€£æŠ•/è¿½åŠ"}]},
  // ãƒ†ãƒ¼ãƒ6ï¼šä¾å­˜
  {id:"t6-A",pairId:"t6",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘äººã«ä¾å­˜ã—ã‚„ã™ã•ã¯ï¼Ÿ",
    choices:[{id:"D",label:"ã»ã¼ä¾å­˜ã›ãšè‡ªç«‹çš„"},{id:"C",label:"é©åº¦ã«é ¼ã‚Œã‚‹"},{id:"B",label:"ä¾å­˜å‚¾å‘ãŒã‚ã‚‹"},{id:"A",label:"å¼·ãä¾å­˜ã—ãŒã¡"}]},
  {id:"t6-B",pairId:"t6",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘ç›¸æ‰‹ã¸ã®ä¾å­˜ã¯ï¼Ÿ",
    choices:[{id:"D",label:"è‡ªç«‹ã‚’ä¿ã¦ã‚‹"},{id:"C",label:"ãƒãƒ©ãƒ³ã‚¹ã¯æ¦‚ã­è‰¯ã„"},{id:"B",label:"é ¼ã‚ŠãŒã¡ã«ãªã‚‹"},{id:"A",label:"å¼·ãä¾å­˜/ç›¸æ‰‹ä¸­å¿ƒã«ãªã‚‹"}]},
  // ãƒ†ãƒ¼ãƒ7ï¼šè‡ªå·±ä¾¡å€¤
  {id:"t7-A",pairId:"t7",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘è‡ªå·±è‚¯å®šæ„Ÿã¯ï¼Ÿ",
    choices:[{id:"D",label:"å®‰å®šã—ã¦é«˜ã„"},{id:"C",label:"æ¦‚ã­å®‰å®š"},{id:"B",label:"æºã‚Œã‚„ã™ã„"},{id:"A",label:"ä½ããªã‚Šã‚„ã™ã„"}]},
  {id:"t7-B",pairId:"t7",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘ã†ã¾ãã„ã‹ãªã„æ™‚ã«è‡ªå·±ä¾¡å€¤ã¯ï¼Ÿ",
    choices:[{id:"D",label:"å¤§ããã¯æºã‚Œãªã„"},{id:"C",label:"å°‘ã—æºã‚Œã‚‹ãŒç«‹ã¦ç›´ã›ã‚‹"},{id:"B",label:"è‡ªåˆ†ã‚’è²¬ã‚ãŒã¡"},{id:"A",label:"è‡ªåˆ†ã®ä¾¡å€¤ãŒç„¡ã„ã¨æ„Ÿã˜ã‚„ã™ã„"}]},
  // ãƒ†ãƒ¼ãƒ8ï¼šå¢ƒç•Œ
  {id:"t8-A",pairId:"t8",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘å¢ƒç•Œç·šï¼ˆæ–­ã‚‹/ãŠé¡˜ã„ã™ã‚‹ï¼‰ã¯ï¼Ÿ",
    choices:[{id:"D",label:"é©åˆ‡ã«è¨€èªåŒ–ã§ãã‚‹"},{id:"C",label:"æ¦‚ã­ã§ãã‚‹"},{id:"B",label:"æ›–æ˜§ã«ãªã‚ŠãŒã¡"},{id:"A",label:"ã»ã¼è¨€ãˆãªã„"}]},
  {id:"t8-B",pairId:"t8",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘å¢ƒç•Œç·šã¯ï¼Ÿ",
    choices:[{id:"D",label:"é©åˆ‡ã«æ‰±ãˆã‚‹"},{id:"C",label:"æ¦‚ã­æ‰±ãˆã‚‹"},{id:"B",label:"ç”˜ããªã‚‹/åˆã‚ã›ã™ãã‚‹"},{id:"A",label:"è¨€ãˆãšã«é£²ã¿è¾¼ã¿ãŒã¡"}]},
  // ãƒ†ãƒ¼ãƒ9ï¼šå®‰å¿ƒåˆå›³
  {id:"t9-A",pairId:"t9",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘è‡ªåˆ†ã‚’è½ã¡ç€ã‘ã‚‹æ–¹æ³•ã¯ï¼Ÿ",
    choices:[{id:"D",label:"ç¢ºç«‹ã—ã¦å†ç¾æ€§ãŒé«˜ã„"},{id:"C",label:"ã„ãã¤ã‹æŒã£ã¦ã„ã‚‹"},{id:"B",label:"æ™‚ã€…ã†ã¾ãã„ã"},{id:"A",label:"ã»ã¨ã‚“ã©ç„¡ã„"}]},
  {id:"t9-B",pairId:"t9",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘ä¸å®‰æ™‚ã®ã‚»ãƒ«ãƒ•ã‚±ã‚¢ã¯ï¼Ÿ",
    choices:[{id:"D",label:"å®‰å®šã—ã¦æ©Ÿèƒ½ã™ã‚‹"},{id:"C",label:"å¤šãã¯æ©Ÿèƒ½ã™ã‚‹"},{id:"B",label:"æ©Ÿèƒ½ã—ã¥ã‚‰ã„"},{id:"A",label:"ã»ã¼æ©Ÿèƒ½ã—ãªã„"}]},
  // ãƒ†ãƒ¼ãƒ10ï¼šæœªæ¥ä¸å®‰
  {id:"t10-A",pairId:"t10",role:"A",stage:4,type:"q",stem:"ã€æ™®æ®µã€‘æœªæ¥ã¸ã®ä¸å®‰æ„Ÿã¯ï¼Ÿ",
    choices:[{id:"D",label:"å°ã•ã„/æ‰±ãˆã‚‹"},{id:"C",label:"æ³¢ã¯ã‚ã‚‹ãŒæ‰±ãˆã‚‹"},{id:"B",label:"ã‚„ã‚„å¼·ã„"},{id:"A",label:"å¼·ãã¨ã‚‰ã‚ã‚Œã‚„ã™ã„"}]},
  {id:"t10-B",pairId:"t10",role:"B",stage:4,type:"q",stem:"ã€æ‹æ„›ä¸­ã€‘æœªæ¥ã¸ã®ä¸å®‰æ„Ÿã¯ï¼Ÿ",
    choices:[{id:"D",label:"å°ã•ã„/æ‰±ãˆã‚‹"},{id:"C",label:"æ³¢ã¯ã‚ã‚‹ãŒæ‰±ãˆã‚‹"},{id:"B",label:"å¼·ã¾ã‚Šã‚„ã™ã„"},{id:"A",label:"ã¨ã¦ã‚‚å¼·ããªã‚‹"}]},
];

/* ====== å…¨ä½“ä¸¦ã³ï¼šIntro â†’ S1 â†’ Intro â†’ S2 â†’ Intro â†’ S3 â†’ Intro â†’ S4 ====== */
const INTRO1 = {type:"intro",stage:1,title:"ç¬¬1æ®µéšï¼šæ ¹ã£ã“ã®æ„›ç€ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆ40ã€œ60å•ï¼‰",
  body:[
    "éå»ã®æ‹æ„›ã®ã€å®Ÿéš›ã®è¡Œå‹•ã€ã§ç­”ãˆã¦ãã ã•ã„ã€‚",
    "é¸æŠè‚¢ã¯æ¯å•ãƒªã‚¢ãƒ«ãªè¡Œå‹•ã«åˆã‚ã›ã¦ç•°ãªã‚Šã¾ã™ï¼ˆå›ºå®šã®A/B/C/Dã§ã¯ã‚ã‚Šã¾ã›ã‚“ï¼‰ã€‚",
    "A=ä¸å®‰ï¼B=å›é¿ï¼C=æã‚Œå›é¿ï¼D=å®‰å®š ã«å¯¾å¿œã—ã€ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆã«åæ˜ ã•ã‚Œã¾ã™ã€‚"
  ]};

const FLOW = [
  INTRO1, ...S1,
  S2_INTRO, ...S2,
  S3_INTRO, ...S3,
  S4_INTRO, ...S4
];

/* ============================================================
   é€²æ—ãƒ»UI
============================================================ */
const screen = document.getElementById('screen');
const bar = document.getElementById('bar');
const counter = document.getElementById('counter');

let idx = 0;
const answers = new Map(); // key = index in FLOW (question only) -> choiceId ("A".."D")

const totalQuestions = FLOW.filter(x=>x.type==="q").length;
function currentQuestionNumber(i){
  let n=0;
  for(let k=0;k<=i;k++){ if(FLOW[k].type==="q") n++; }
  return n;
}
function progressPercent(i){
  return Math.round(currentQuestionNumber(i) / Math.max(1,totalQuestions) * 100);
}

function render(){
  const item = FLOW[idx];
  const curN = currentQuestionNumber(idx);
  const pct = progressPercent(idx);
  counter.textContent = `${curN}/${totalQuestions} (${pct}%)`;
  bar.style.width = `${pct}%`;

  if(item.type==="intro"){
    renderIntro(item);
  }else{
    renderQuestion(item, curN, pct);
  }
}

function renderIntro(intro){
  const root = document.createElement('div');
  root.className = "intro";
  root.innerHTML = `
    <h2 class="qtitle" style="margin:0">${intro.title}</h2>
    <div class="muted" style="margin:6px 0 14px">æ¬¡ã®ãƒšãƒ¼ã‚¸ã‹ã‚‰ã“ã®æ®µéšã®è¨­å•ãŒå§‹ã¾ã‚Šã¾ã™ã€‚</div>
    <div class="grid2">
      <div class="card" style="border-style:dashed">
        <div class="stage">ãƒã‚¤ãƒ³ãƒˆ</div>
        <ul style="margin:8px 0 0 16px; padding:0; color:#6b7280; line-height:1.8;">
          ${intro.body.map(t=>`<li>${t}</li>`).join("")}
        </ul>
      </div>
      <div class="card" style="display:flex;flex-direction:column;justify-content:space-between">
        <div>
          <div class="stage">ãƒ’ãƒ³ãƒˆ</div>
          <div class="muted" style="line-height:1.8">
            æ­£ç›´ã«ç­”ãˆã‚‹ã»ã©çµæœãŒå½¹ç«‹ã¡ã¾ã™ã€‚æ—©æŠ¼ã—ã›ãšã€å½“æ™‚ã®è‡ªåˆ†/ä»Šã®è‡ªåˆ†ã‚’æ€ã„å‡ºã—ã¦é¸ã‚“ã§ãã ã•ã„ã€‚
          </div>
        </div>
        <div class="row" style="margin-top:14px;justify-content:flex-end">
          <button class="btn btn-primary" id="startStage">é–‹å§‹ã™ã‚‹</button>
        </div>
      </div>
    </div>
  `;
  screen.replaceChildren(root);
  document.getElementById('startStage').onclick = ()=>{ idx++; render(); };
}

function renderQuestion(q, n, pct){
  const root = document.createElement('div');
  const stageTitle = (q.stage===1) ? "ç¬¬1æ®µéšï¼šæ ¹ã£ã“ã®æ„›ç€ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆéå»ã®è‡ªåˆ†ã§å›ç­”ï¼‰"
                    : (q.stage===2) ? "ç¬¬2æ®µéšï¼šæˆé•·ãƒ»æ”¹å–„åº¦ï¼ˆæ˜”ã¨ä»Šã®æ¯”è¼ƒï¼‰"
                    : (q.stage===3) ? "ç¬¬3æ®µéšï¼šæ”¹å–„ã®å®‰å®šåº¦ï¼ˆã‚¹ãƒˆãƒ¬ã‚¹ä¸‹ãƒ»ä¸€äººã®ã¨ãï¼‰"
                    : "ç¬¬4æ®µéšï¼šéš ã‚Œã‚¿ã‚¤ãƒ—ï¼ˆæ™®æ®µ vs æ‹æ„›ä¸­ï¼‰";

  root.innerHTML = `
    <div class="stage">${stageTitle}</div>
    <div class="qtitle">${q.stem}</div>
  `;

  const choices = document.createElement('div');
  choices.className = "grid2";
  const chosen = answers.get(idx);
  q.choices.forEach(opt=>{
    const b = document.createElement('button');
    b.className = "choice" + (chosen===opt.id ? " selected" : "");
    b.textContent = opt.label;
    b.onclick = ()=>{
      answers.set(idx, opt.id);
      Array.from(choices.children).forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected');
      nextBtn.disabled = false;
      warn.style.visibility = 'hidden';
    };
    choices.appendChild(b);
  });
  root.appendChild(choices);

  const nav = document.createElement('div');
  nav.className = "row";
  const back = document.createElement('button');
  back.className = "btn btn-ghost";
  back.textContent = "æˆ»ã‚‹";
  back.onclick = ()=>{ if(idx>0){ idx--; render(); } };
  back.disabled = idx===0;

  const warn = document.createElement('div');
  warn.className = "muted";
  warn.textContent = "æœªå›ç­”ã®ã¾ã¾æ¬¡ã¸ã¯é€²ã‚ã¾ã›ã‚“";
  warn.style.flex = "1";
  warn.style.textAlign = "center";
  warn.style.visibility = answers.has(idx) ? 'hidden' : 'visible';

  const nextBtn = document.createElement('button');
  nextBtn.className = "btn btn-primary";
  nextBtn.textContent = nextLabel();
  nextBtn.disabled = !answers.has(idx);
  nextBtn.onclick = ()=>{
    if(!answers.has(idx)){ warn.style.visibility = 'visible'; return; }
    if(idx < FLOW.length-1){ idx++; render(); }
    else { showResult(); }
  };

  nav.appendChild(back);
  nav.appendChild(warn);
  nav.appendChild(nextBtn);
  root.appendChild(nav);

  screen.replaceChildren(root);
}

function nextLabel(){
  // æœ€å¾Œã®ã‚¢ã‚¤ãƒ†ãƒ ãªã‚‰ã€Œçµæœã‚’è¦‹ã‚‹ã€
  if(idx===FLOW.length-1) return "çµæœã‚’è¦‹ã‚‹";
  // æ¬¡ãŒ intro ã®å ´åˆã§ã‚‚æ–‡è¨€ã¯ã€Œæ¬¡ã¸ã€ã§OK
  return "æ¬¡ã¸";
}

/* ============================================================
   é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯
============================================================ */
// ä¾¿åˆ©é–¢æ•°
const scoreFromChoice = cid => ({A:0,B:1,C:2,D:3}[cid] ?? 0);

function computeStage1(){
  // ãƒ¬ãƒ¼ãƒ€ãƒ¼ç”¨ï¼šA=ä¸å®‰ / B=å›é¿ / C=æã‚Œå›é¿ / D=å®‰å®š
  let a=0,b=0,c=0,d=0, cnt=0;
  for(let i=0;i<FLOW.length;i++){
    const it = FLOW[i];
    if(it.type!=="q" || it.stage!==1) continue;
    const cid = answers.get(i);
    if(!cid) continue;
    // S1 ã¯é¸æŠè‚¢ã« aff ãŒä»˜ã„ã¦ã„ã‚‹å‰æ
    const aff = (it.choices.find(ch=>ch.id===cid)?.aff)||null;
    if(aff==="A") a++;
    else if(aff==="B") b++;
    else if(aff==="C") c++;
    else if(aff==="D") d++;
    cnt++;
  }
  const total = Math.max(1,a+b+c+d);
  const pct = v=>Math.round(v/total*100);
  return { anxious:pct(a), avoidant:pct(b), fearful:pct(c), secure:pct(d) };
}

function computeStage2(){
  let sum=0, max=0;
  for(let i=0;i<FLOW.length;i++){
    const it = FLOW[i];
    if(it.type!=="q" || it.stage!==2) continue;
    const cid = answers.get(i);
    if(!cid) continue;
    sum += scoreFromChoice(cid);
    max += 3;
  }
  const pct = max? Math.round(sum/max*100) : 0;
  return pct; // æ”¹å–„åº¦ï¼…
}

function computeStage3(){
  // åŒã˜0..3é…ç‚¹ã‚’ï¼…åŒ–
  let sum=0, max=0;
  for(let i=0;i<FLOW.length;i++){
    const it = FLOW[i];
    if(it.type!=="q" || it.stage!==3) continue;
    const cid = answers.get(i);
    if(!cid) continue;
    sum += scoreFromChoice(cid);
    max += 3;
  }
  const pct = max? Math.round(sum/max*100) : 0;
  // ãƒ©ãƒ™ãƒ«
  const label = (pct>=75) ? "å¼·ã„" : (pct>=50) ? "ãµã¤ã†" : (pct>=25) ? "ã‚„ã‚„å¼±ã„" : "å¼±ã„";
  return { pct, label };
}

function computeStage4(){
  // pairId ã”ã¨ã« A(æ™®æ®µ) ã¨ B(æ‹æ„›ä¸­) ã®å·®åˆ†ï¼ˆB - Aï¼‰
  const pairs = {};
  for(let i=0;i<FLOW.length;i++){
    const it = FLOW[i];
    if(it.type!=="q" || it.stage!==4) continue;
    const cid = answers.get(i); // "A".."D"
    if(!cid) continue;
    const sc = scoreFromChoice(cid); // 0..3
    if(!pairs[it.pairId]) pairs[it.pairId] = {};
    pairs[it.pairId][it.role] = sc;
  }
  let deltas = [];
  for(const pid in pairs){
    const A = pairs[pid].A ?? 0;
    const B = pairs[pid].B ?? 0;
    // æ™®æ®µ(A)ã«æ¯”ã¹ã¦æ‹æ„›ä¸­(B)ãŒæ‚ªåŒ–ã—ã¦ã„ã‚Œã°ãƒªã‚¹ã‚¯ä¸Šæ˜‡
    const delta = (A - B); // Aã‚ˆã‚ŠBãŒä½ã„ = ãƒã‚¤ãƒŠã‚¹ï¼ˆ=æ‚ªåŒ–ï¼‰
    deltas.push(delta);
  }
  // deltaã®å¹³å‡ãŒ0ã«è¿‘ã„/ãƒ—ãƒ©ã‚¹â†’ã‚®ãƒ£ãƒƒãƒ—å°ã€ãƒã‚¤ãƒŠã‚¹ãŒå¤§â†’æ‹æ„›ä¸­ã«æ‚ªåŒ–
  const avg = deltas.length? deltas.reduce((p,c)=>p+c,0)/deltas.length : 0;
  let label = "ä½ï¼ˆæ™®æ®µã¨æ‹æ„›ä¸­ã®å·®ã¯å°‘ãªã„ï¼‰";
  if(avg < -0.75) label = "é«˜ï¼ˆæ‹æ„›ä¸­ã¯æ‚ªåŒ–ã—ã‚„ã™ã„ï¼‰";
  else if(avg < -0.35) label = "ã‚„ã‚„é«˜ï¼ˆçŠ¶æ³ã§æ‚ªåŒ–ã—ãŒã¡ï¼‰";
  else if(avg < -0.05) label = "ä¸­ï¼ˆã‚„ã‚„æºã‚‰ãã‚ã‚Šï¼‰";
  return { avg, label };
}

function dominantStyleLabel(s1){
  const entries = [
    ["ä¸å®‰å‹", s1.anxious],
    ["å›é¿å‹", s1.avoidant],
    ["æã‚Œå›é¿å‹", s1.fearful],
    ["å®‰å®šå‹", s1.secure],
  ].sort((a,b)=>b[1]-a[1]);
  return entries[0][0];
}

/* ============================================================
   çµæœç”»é¢ï¼ˆãƒ¬ãƒ¼ãƒ€ãƒ¼ä»˜ãï¼‰
============================================================ */
function showResult(){
  // è¨ˆç®—
  const s1 = computeStage1();
  const s2pct = computeStage2();
  const s3 = computeStage3();
  const s4 = computeStage4();
  const dom = dominantStyleLabel(s1);
  const summaryMap = {
    "ä¸å®‰å‹":"æˆé•·ä¸­ã®ä¸å®‰å‹ã€‚å®‰å¿ƒã®åˆå›³ã‚’è¨­è¨ˆã—ã¦ã„ãã¨å®‰å®šã—ã‚„ã™ã„ã€‚",
    "å›é¿å‹":"è·é›¢ã‚’å–ã‚ŠãŒã¡ã€‚å¢ƒç•Œã¨ã¤ãªãŒã‚Šã®ä¸¡ç«‹ãŒã‚«ã‚®ã€‚",
    "æã‚Œå›é¿å‹":"è¿‘ã¥ããŸã„/æ€–ã„ãŒåŒæ™‚é€²è¡Œã€‚å°ã•ãå®‰å…¨ã«è¿‘ã¥ãç·´ç¿’ãŒæœ‰åŠ¹ã€‚",
    "å®‰å®šå‹":"å®‰å®šå‚¾å‘ã€‚ã„ã¾ã®ã‚„ã‚Šæ–¹ã‚’ç¶šã‘ã¤ã¤ç›¸æ‰‹ã«åˆã‚ã›ã¦èª¿æ•´ã‚’ã€‚"
  };

  const root = document.createElement('div');

  // ã‚¹ã‚³ã‚¢æ¦‚è¦
  const head = document.createElement('div');
  head.className = "grid2";
  head.innerHTML = `
    <div class="card">
      <div class="stage">æ ¹ã£ã“ã®æ„›ç€ã‚¹ã‚¿ã‚¤ãƒ«ï¼ˆå‰²åˆï¼‰</div>
      <div class="grid2" style="margin-top:6px">
        <div class="pill">ä¸å®‰å‹ï¼š${s1.anxious}%</div>
        <div class="pill">å›é¿å‹ï¼š${s1.avoidant}%</div>
        <div class="pill">æã‚Œå›é¿å‹ï¼š${s1.fearful}%</div>
        <div class="pill">å®‰å®šå‹ï¼š${s1.secure}%</div>
      </div>
    </div>
    <div class="card">
      <div class="stage">æˆé•·ãƒ»æ”¹å–„åº¦ / ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ / éš ã‚Œã‚¿ã‚¤ãƒ—</div>
      <div class="grid2" style="margin-top:6px">
        <div class="pill">æˆé•·åº¦ï¼š${s2pct}%</div>
        <div class="pill">ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ï¼š${s3.label}ï¼ˆ${s3.pct}%ï¼‰</div>
        <div class="pill">éš ã‚Œã‚¿ã‚¤ãƒ—ï¼š${s4.label}</div>
        <div class="pill">å„ªå‹¢ã‚¿ã‚¤ãƒ—ï¼š${dom}</div>
      </div>
    </div>
  `;
  root.appendChild(head);

  // ãƒ¬ãƒ¼ãƒ€ãƒ¼ãƒãƒ£ãƒ¼ãƒˆ
  const cvWrap = document.createElement('div');
  cvWrap.className = "card";
  cvWrap.style.marginTop = "12px";
  const cv = document.createElement('canvas');
  cv.height = 280;
  cvWrap.appendChild(cv);
  root.appendChild(cvWrap);

  // ç·åˆåˆ¤å®š
  const sum = document.createElement('div');
  sum.className = "card";
  sum.style.marginTop = "12px";
  sum.innerHTML = `
    <div class="qtitle" style="margin:0 0 6px">ç·åˆåˆ¤å®š</div>
    <div class="muted" style="line-height:1.9">
      ğŸ‘‰ ã€Œ${summaryMap[dom]}ã€<br/>
      ãƒ»ç¬¬2æ®µéšã®æˆé•·åº¦ï¼š${s2pct}%ï¼ˆé«˜ã„ã»ã©â€œä»¥å‰ã‚ˆã‚Šæ•´ãˆã‚‰ã‚Œã¦ã„ã‚‹â€ï¼‰<br/>
      ãƒ»ç¬¬3æ®µéšã®ã‚¹ãƒˆãƒ¬ã‚¹è€æ€§ï¼š${s3.label}ï¼ˆ${s3.pct}%ï¼‰<br/>
      ãƒ»ç¬¬4æ®µéšã®éš ã‚Œã‚¿ã‚¤ãƒ—ï¼š${s4.label}
    </div>
  `;
  root.appendChild(sum);

  // ãƒªã‚¹ã‚¿ãƒ¼ãƒˆ
  const nav = document.createElement('div');
  nav.className = "row";
  const restart = document.createElement('button');
  restart.className = "btn btn-ghost";
  restart.textContent = "æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™";
  restart.onclick = ()=>{ answers.clear(); idx=0; render(); };
  nav.appendChild(restart);
  root.appendChild(nav);

  // æç”»
  screen.replaceChildren(root);

  // ãƒ¬ãƒ¼ãƒ€ãƒ¼æç”»
  new Chart(cv.getContext("2d"),{
    type:"radar",
    data:{
      labels:["ä¸å®‰","å›é¿","æã‚Œå›é¿","å®‰å®š"],
      datasets:[{
        label:"ã‚¹ã‚¿ã‚¤ãƒ«æ¯”ç‡",
        data:[s1.anxious, s1.avoidant, s1.fearful, s1.secure],
        fill:true, borderWidth:2,
        borderColor:"rgba(244,63,94,.9)",
        backgroundColor:"rgba(244,63,94,.15)",
        pointBackgroundColor:"rgba(244,63,94,1)"
      }]
    },
    options:{
      responsive:true,
      plugins:{ legend:{ display:false } },
      scales:{ r:{
        suggestedMin:0, suggestedMax:100,
        ticks:{ stepSize:25, showLabelBackdrop:false },
        grid:{ color:"rgba(251,113,133,.25)" }
      }}
    }
  });
}

/* ============================================================
   èµ·å‹•
============================================================ */
render();
</script>
</body>
</html>
