<!doctype html><html lang="ja"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>4段階愛着診断</title>
<style>
:root{--rose50:#fff1f2;--rose100:#ffe4e6;--rose200:#fecdd3;--rose300:#fda4af;--rose400:#fb7185;--rose500:#f43f5e;--rose600:#e11d48;--ink:#7f1d1d}
*{box-sizing:border-box}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Hiragino Kaku Gothic ProN","Yu Gothic",Meiryo,ui-sans-serif;color:var(--ink);background:linear-gradient(#fff,#fff5f6)}
.wrap{max-width:880px;margin:22px auto;padding:18px}
.h1{font-weight:800;font-size:26px;color:var(--rose600);text-align:center;margin:8px 0}
.sub{color:#9f1239;text-align:center;font-size:12px;margin-bottom:14px}
.card{background:#fff;border:1px solid var(--rose200);border-radius:16px;padding:16px;box-shadow:0 1px 6px rgba(244,63,94,.08)}
.row{display:flex;gap:12px;align-items:center;justify-content:space-between}
.bar{height:8px;background:var(--rose100);border-radius:999px;overflow:hidden}.bar>div{height:8px;background:var(--rose400)}
.sec{font-size:12px;color:#9f1239;margin:0 0 6px}
.q{font-weight:700;line-height:1.6;margin:6px 0 10px}
#choices{display:flex;flex-direction:column;gap:12px}
.choice{border:1px solid var(--rose200);border-radius:12px;padding:10px 12px;text-align:left;background:#fff;cursor:pointer;display:block;width:100%}
.choice:hover{border-color:var(--rose300)}.choice.sel{border-color:var(--rose400);background:var(--rose50)}
.btn{border:none;border-radius:12px;padding:10px 16px;font-weight:700;color:#fff;background:var(--rose500);cursor:pointer}
.btn:disabled{background:var(--rose300);cursor:not-allowed}
.btn-ghost{background:#fff;color:var(--rose600);border:1px solid var(--rose200)}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}@media(max-width:640px){.grid2{grid-template-columns:1fr}}
.small{font-size:12px;color:#a11a2b}
canvas{max-width:100%}
#err{position:fixed;left:12px;right:12px;bottom:12px;background:#fff1f2;border:1px solid #fecdd3;color:#7f1d1d;border-radius:10px;padding:10px 12px;font-size:12px;display:none;white-space:pre-wrap}
</style>
<!-- Chart.js（レーダー用） -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js" defer></script>
</head><body>
<div class="wrap">
  <div class="h1">4段階愛着診断</div>
  <div class="sub">画面に結果を表示します（スクショ/コピーOK）。</div>
  <div id="app"></div>
</div>
<div id="err"></div>

<script>
(function(){
  const showErr=(msg)=>{const el=document.getElementById('err');el.style.display='block';el.textContent=msg;}
  window.addEventListener('error',e=>showErr('Script error: '+(e.error&&e.error.stack?e.error.stack:e.message)));
  try{
    /* ===== 設問（簡略：第1=20、第2=20、第3=20、第4=20=10ペア） ===== */
    const S1=[ /* ←（前回送付のS1 20問） */ 
      {s:"過去の恋愛で、好きな人からの返信が遅かったとき、どうしていましたか？",c:[["A","何度もLINEを送ってしまった"],["B","『なんで？』と問い詰めた"],["C","平気を装すが内心は不安だらけ"],["D","忙しいだけと捉えて待てた"]]},
      {s:"相手がSNS更新しているのに自分に返信が無いときは？",c:[["A","『無視？』と不安でいっぱい"],["B","わざと未読無視して距離を置く"],["C","気にしないふりで落ち込む"],["D","たまたまと流せた"]]},
      {s:"デート中に相手がスマホばかり見ていたときは？",c:[["A","飽きられたかもと不安"],["B","自分も距離をとる行動に出た"],["C","笑顔でごまかし心は傷つく"],["D","仕事かもと受け止めた"]]},
      {s:"『今日は疲れてる』とそっけないときは？",c:[["A","嫌われたかもと不安爆発"],["B","こちらも冷たくして距離"],["C","我慢して笑顔、内心孤独"],["D","休ませようと落ち着けた"]]},
      {s:"予定優先で会えなかったときは？",c:[["A","『私より予定？』と不安"],["B","『じゃあ自由に』と突き放す"],["C","大丈夫と言い落ち込む"],["D","次を楽しみにできた"]]},
      {s:"他の異性と楽しそうに話していたときは？",c:[["A","取られる不安でざわつく"],["B","自分も他と距離を縮める"],["C","笑顔で黙るがモヤる"],["D","信頼して見守れた"]]},
      {s:"返信が短文で冷たいときは？",c:[["A","嫌われた？と不安"],["B","わざと短文で返す"],["C","明るく返しつつ落ち込む"],["D","疲れかなと受け流す"]]},
      {s:"趣味/仕事を優先され後回しと感じたときは？",c:[["A","大事にされてない不安"],["B","『勝手にして』と突き放す"],["C","応援のふりで寂しい"],["D","応援しようと思えた"]]},
      {s:"気持ちを軽く流されたと感じたときは？",c:[["A","伝わらないと強い不安"],["B","それ以上話さず閉じる"],["C","笑って流し心に残る"],["D","タイミングを改めようと思えた"]]},
      {s:"『一人の時間が欲しい』と言われたときは？",c:[["A","嫌われた？と不安爆発"],["B","私も好きにすると距離"],["C","表面OK、内心寂しい"],["D","理解して落ち着けた"]]},
      {s:"友達との予定を優先されたときは？",c:[["A","私より友達？と拗ねる"],["B","別の予定を入れて距離"],["C","大丈夫と言い寂しい"],["D","友達も大事と理解"]]},
      {s:"記念日/誕生日を忘れられたときは？",c:[["A","大事にされてないと怒る/泣く"],["B","冷めたと突き放す"],["C","平気なふりで傷つく"],["D","忙しかっただけと受け止める"]]},
      {s:"急に連絡が減ったときは？",c:[["A","不安で追いLINEする"],["B","自分も減らして距離"],["C","何も言えず待ち続ける"],["D","事情があるかもと考える"]]},
      {s:"態度が冷たくなったと感じたときは？",c:[["A","理由を何度も確認する"],["B","『もういい』と突き放す"],["C","普通に振る舞い心乱れる"],["D","タイミングを見て話す"]]},
      {s:"不安を『考えすぎ』と言われたときは？",c:[["A","さらに食い下がる"],["B","黙って引く"],["C","平気と笑い傷つく"],["D","そうかもと受け止める"]]},
      {s:"未読/既読スルーのときは？",c:[["A","送り直し/電話する"],["B","もう知らないと突き放す"],["C","平気なふりで待つ"],["D","忙しいと解釈して待つ"]]},
      {s:"元恋人の話をされたときは？",c:[["A","まだ好き？と問い詰める"],["B","不機嫌で距離をとる"],["C","平気を装いモヤる"],["D","昔の話と受け止める"]]},
      {s:"自分が体調不良で心配されなかったときは？",c:[["A","大事にされてないと泣く"],["B","期待しないと突き放す"],["C","笑顔で我慢"],["D","事情があると受け流す"]]},
      {s:"気持ちを素直に伝えて軽く流されたときは？",c:[["A","やっぱりダメだと不安増"],["B","もういいと閉じる"],["C","笑って落ち込む"],["D","今は時期でないと捉える"]]},
      {s:"言動から『愛されてる？』と不安のときは？",c:[["A","何度も確かめる"],["B","不安を隠し冷たい態度"],["C","言えずモヤモヤを抱える"],["D","信頼して落ち着けた"]]}
    ];
    const S2=[ /* 前回の20問定義（省略可：実装はスケール4段を割当） */ 
      {s:"昔より不安時に落ち着けるようになった？",pol:"pos"},
      {s:"依存的な行動は減った？",pol:"pos"},
      {s:"相手に合わせすぎは減った？",pol:"pos"},
      {s:"感情的になりやすさは改善した？",pol:"pos"},
      {s:"『試す行動』は減った？",pol:"pos"},
      {s:"連絡が3日無いとき今のあなたは？",pol:"pos"},
      {s:"『一人の時間が欲しい』を受け止められる？",pol:"pos"},
      {s:"ケンカ時に今のあなたは？",pol:"pos"},
      {s:"他の異性と仲良く→今の対応は？",pol:"pos"},
      {s:"不安を感じても自分で落ち着ける方法は？",pol:"pos"},
      {s:"相談できなくても冷静さを保てる？",pol:"pos"},
      {s:"恋愛以外の時間を大事にできる？",pol:"pos"},
      {s:"相手がいなくても自分の価値を思える？",pol:"pos"},
      {s:"恋愛がなくても生活は安定？",pol:"pos"},
      {s:"『恋愛なくても幸せ』と思えることがある？",pol:"pos"},
      {s:"頭は大丈夫でも心は不安になる？",pol:"neg"},
      {s:"知識はあっても不安がぶり返す？",pol:"neg"},
      {s:"『冷静でいよう』でも同じ行動をする？",pol:"neg"},
      {s:"うまくいかないと自分を責める？",pol:"neg"},
      {s:"『成長したのに揺らぐ』と感じる？",pol:"neg"}
    ];
    const S3=[
      {s:"3日返信なし→どう感じそう？",pol:"neg"},
      {s:"『距離を置きたい』と言われた→反応は？",pol:"neg"},
      {s:"元カノ/元カレの話→どう感じやすい？",pol:"neg"},
      {s:"急に冷たい態度→どんな気持ちに？",pol:"neg"},
      {s:"不安で眠れなくなることがある？",pol:"neg"},
      {s:"相談相手がいない時の対処は？",pol:"pos"},
      {s:"恋人がいない期間も気持ちは安定？",pol:"pos"},
      {s:"一人で不安を落ち着ける方法がある？",pol:"pos"},
      {s:"一人休日→恋愛ばかり考える？",pol:"neg"},
      {s:"SNSで不安になることは今でもある？",pol:"neg"},
      {s:"恋愛が始まると昔の不安に戻る？",pol:"neg"},
      {s:"相手を疑う気持ちがふと出る？",pol:"neg"},
      {s:"ケンカで感情的になりやすい？",pol:"neg"},
      {s:"不安で自分の価値を疑う？",pol:"neg"},
      {s:"『もう大丈夫』でも恋愛中に揺らぐ？",pol:"neg"},
      {s:"不安をぶつけそうでも落ち着ける？",pol:"pos"},
      {s:"一度落ち着けばその後も安定？",pol:"pos"},
      {s:"以前より冷静に話し合える？",pol:"pos"},
      {s:"強い嫉妬/不安が出ても自分で修正できる？",pol:"pos"},
      {s:"『安定した恋愛を続けられる自信』は？",pol:"pos"}
    ];
    const S4=[
      {t:"返信が遅い",A:["気にならない","少し気になるが切替え可","落ち着かなくなることがある","すぐ不安になる"],B:["何度も確認してしまう","嫌われたかもと考える","平気を装うが不安","忙しいと信じ落ち着ける"]},
      {t:"『一人の時間が欲しい』",A:["理解できる","少し寂しいが割り切れる","否定された気持ちになる","強い孤独感"],B:["不安になり理由を確かめる","何度も連絡してしまう","表面OKで我慢","相手を尊重し安心できる"]},
      {t:"既読/未読スルー",A:["気にしない","少し気になる","モヤつく","不安が強い"],B:["追撃連絡してしまう","試す行動をする","黙って耐える","事情があると待てる"]},
      {t:"元恋人の話題",A:["昔話として受容","少し気になる","モヤモヤが残る","強い不安"],B:["問い詰める","不機嫌で距離","平気を装うが揺れる","冷静に受容"]},
      {t:"友達優先",A:["理解できる","少し寂しい","価値が下がった気持ち","強い孤独感"],B:["拗ねる/責める","距離を取る","表面OKで我慢","予定を応援できる"]},
      {t:"スマホ多用",A:["仕事かもと受容","少し寂しい","気持ちが沈む","不安が強い"],B:["不機嫌になる","自分も距離","黙って我慢","状況を確認して話す"]},
      {t:"相手の異性友だち",A:["信頼できる","少し気になる","比較して不安","強い嫉妬"],B:["問い詰める","他で距離を縮める","明るく装うが不安","信頼して対応"]},
      {t:"ケンカ後",A:["落ち着いて話せる","少し時間が必要","感情が先行","逃げたくなる"],B:["感情的にぶつかる","無視/距離を取る","何も言えず我慢","時間を置き対話する"]},
      {t:"記念日を忘れられた",A:["多忙と理解","少し寂しい","傷つく","強く責めたくなる"],B:["怒る/泣く","冷めたふりをする","笑顔で我慢","状況を聞いて話す"]},
      {t:"相手が忙しい期間",A:["自分の時間に集中","少し不安","孤独感が出る","強い不安"],B:["連絡頻度を強要","距離を置く/試す","耐えるだけになる","応援し自分を満たす"]}
    ];

    /* ===== 変換 ===== */
    const SCALE4=[["A","全く/できない"],["B","少し"],["C","かなり"],["D","ほとんど/できる"]];
    const toStage1=()=>S1.map((q,i)=>({id:"s1-"+(i+1),stage:1,stem:q.s,choices:q.c}));
    const toStage2=()=>S2.map((q,i)=>({id:"s2-"+(i+1),stage:2,stem:q.s,choices:(q.pol==="pos"?SCALE4:[["A","全くその通り"],["B","ややその通り"],["C","あまり当てはまらない"],["D","全く当てはまらない"]]),polarity:q.pol}));
    const toStage3=()=>S3.map((q,i)=>({id:"s3-"+(i+1),stage:3,stem:q.s,choices:(q.pol==="pos"?SCALE4:[["A","強く当てはまる"],["B","やや当てはまる"],["C","あまり当てはまらない"],["D","全く当てはまらない"]]),polarity:q.pol}));
    function toStage4(){const rows=[];S4.forEach((r,i)=>{rows.push({id:`s4a-${i+1}`,stage:4,stem:`${r.t}｜A. 普段の自分`,choices:[["A",r.A[0]],["B",r.A[1]],["C",r.A[2]],["D",r.A[3]]],pair:`p${i}`});rows.push({id:`s4b-${i+1}`,stage:4,stem:`${r.t}｜B. 恋愛中の自分`,choices:[["A",r.B[0]],["B",r.B[1]],["C",r.B[2]],["D",r.B[3]]],pair:`p${i}`});});return rows;}
    const QUESTIONS=[...toStage1(),...toStage2(),...toStage3(),...toStage4()];

    /* ===== 集計 ===== */
    const pct=v=>Math.max(0,Math.min(100,Math.round(v)));
    function scoreStage1(ans){let a=0,b=0,c=0,d=0;ans.forEach(ch=>{if(ch==="A")a++;else if(ch==="B")b++;else if(ch==="C")c++;else if(ch==="D")d++;});const t=a+b+c+d||1;return {anx:pct(a/t*100),avo:pct(b/t*100),fea:pct(c/t*100),sec:pct(d/t*100)};}
    function scoreStage2(rec){let pos=0,max=0;rec.forEach(r=>{const v={"A":0,"B":1,"C":2,"D":3}[r.choice];const norm=(r.polarity==="pos")?v:(3-v);pos+=norm;max+=3;});return pct(pos/(max||1)*100);}
    function scoreStage3(rec){let pos=0,max=0;rec.forEach(r=>{const v={"A":0,"B":1,"C":2,"D":3}[r.choice];const norm=(r.polarity==="pos")?v:(3-v);pos+=norm;max+=3;});const p=pct(pos/(max||1)*100);const label=p>=75?"強い":(p<45?"弱い":"ふつう");return {pct:p,label};}
    function scoreStage4(rec){const pairs={};rec.forEach(r=>{pairs[r.pair]=pairs[r.pair]||{A:null,B:null};if(r.id.startsWith("s4a"))pairs[r.pair].A=r.choice;else pairs[r.pair].B=r.choice;});let gap=0,cnt=0;Object.values(pairs).forEach(p=>{if(p.A&&p.B){const va={"A":0,"B":1,"C":2,"D":3}[p.A];const vb={"A":0,"B":1,"C":2,"D":3}[p.B];gap+=Math.abs(vb-va);cnt++;}});const avg=(gap/(cnt||1));const label=avg>=1.8?"高":avg>=0.8?"中":"低";return {avg:+avg.toFixed(2),label};}

    /* ===== 画面 ===== */
    let idx=0; let answers=[]; let radarChart=null;
    const app=document.getElementById("app");
    const stageTitle=(s)=>s===1?"第1段階：過去の自分（根っこ）":s===2?"第2段階：成長・改善度（昔↔今）":s===3?"第3段階：改善の安定度（ストレス下）":"第4段階：隠れタイプ（普段↔恋愛中）";
    const progress=()=>{const t=QUESTIONS.length;const p=Math.round(idx/t*100);return `<div class="card"><div class="row" style="margin-bottom:8px;font-size:12px;color:#9f1239"><div>第${(QUESTIONS[idx]?.stage)||4}段階</div><div>${Math.min(idx+1,t)}/${t}（${p}%）</div></div><div class="bar"><div style="width:${p}%"></div></div></div>`;}
    function renderQ(){const q=QUESTIONS[idx];const rec=answers.find(a=>a.id===q.id);return `<div class="card"><div class="sec">${stageTitle(q.stage)}</div><div class="q">${q.stem}</div><div id="choices"></div><div class="row" style="margin-top:12px"><button class="btn-ghost" id="prev" ${idx===0?"disabled":""}>戻る</button><button class="btn" id="next" ${rec?"":"disabled"}>${idx+1===QUESTIONS.length?"結果を見る":"次へ"}</button></div></div>`;}
    function radarMount(s1){const ctx=document.getElementById('radar');if(!ctx||!window.Chart) return; if(radarChart) radarChart.destroy(); radarChart=new Chart(ctx,{type:'radar',data:{labels:['不安型','回避型','恐れ回避型','安定型'],datasets:[{label:'構成比(%)',data:[s1.anx,s1.avo,s1.fea,s1.sec],fill:true,backgroundColor:'rgba(244,63,94,0.25)',borderColor:'rgba(244,63,94,1)',pointBackgroundColor:'rgba(244,63,94,1)'}]},options:{responsive:true,scales:{r:{beginAtZero:true,suggestedMax:100,ticks:{display:false}}},plugins:{legend:{display:false}}});}
    function renderResult(){const by=(n)=>answers.filter(a=>a.stage===n);const s1=scoreStage1(by(1).map(a=>a.choice));const s2=scoreStage2(by(2));const s3=scoreStage3(by(3));const s4=scoreStage4(by(4));const dom=Object.entries({不安型:s1.anx,回避型:s1.avo,恐れ回避型:s1.fea,安定型:s1.sec}).sort((a,b)=>b[1]-a[1])[0][0];const sum={"不安型":"成長中の不安型。改善は進んでいるが、恋愛中は再燃しやすいタイプ。","回避型":"距離を取りがち。自分のペースを守りつつ対話の練習が鍵。","恐れ回避型":"近づきたいのに怖い。安心の土台づくりを最優先に。","安定型":"安定傾向が強め。いまのやり方を継続するとさらに安定。"};const hidden=s4.label==="高"?"普段は保てても恋愛中に揺らぎやすい。":(s4.label==="中"?"状況次第で揺れやすいポイントあり。":"普段と恋愛中の差は小さめ。");return `<div class="card"><div class="h1" style="font-size:22px;margin:0 0 8px">診断結果</div><div class="grid2" style="margin:10px 0"><div class="card"><b>不安型</b>：${s1.anx}%</div><div class="card"><b>回避型</b>：${s1.avo}%</div><div class="card"><b>恐れ回避型</b>：${s1.fea}%</div><div class="card"><b>安定型</b>：${s1.sec}%</div></div><div class="card"><div class="sec">レーダーチャート（スタイル構成比）</div><canvas id="radar" height="260"></canvas></div><div class="grid2" style="margin:10px 0"><div class="card"><b>現在の成長度</b>：${s2}%</div><div class="card"><b>ストレス耐性</b>：${s3.label}（${s3.pct}%）</div></div><div class="card" style="background:var(--rose50)">隠れタイプ：<b>${s4.label}</b>（差の平均 ${s4.avg}）<br/><span class="small">${hidden}</span></div><div class="card">総合判定：<b>${dom}</b>。${sum[dom]}</div><div class="row" style="margin-top:12px"><button class="btn-ghost" id="reset">最初からやり直す</button></div></div>`;}
    function mountChoices(q){const box=document.getElementById("choices");const chosen=(answers.find(a=>a.id===q.id)||{}).choice;(q.choices||[]).forEach(([id,label])=>{const b=document.createElement("button");b.className="choice"+(chosen===id?" sel":"");b.textContent=label;b.onclick=()=>{answers=[...answers.filter(a=>a.id!==q.id),{id:q.id,choice:id,stage:q.stage,polarity:q.polarity,pair:q.pair}];render();};box.appendChild(b);});}
    function render(){const t=QUESTIONS.length;if(idx>=t){document.getElementById('app').innerHTML=renderResult();const by=n=>answers.filter(a=>a.stage===n);const s1=scoreStage1(by(1).map(a=>a.choice));radarMount(s1);document.getElementById('reset').onclick=()=>{idx=0;answers=[];render()};return;}document.getElementById('app').innerHTML=progress()+renderQ();const q=QUESTIONS[idx];mountChoices(q);document.getElementById('prev').onclick=()=>{if(idx>0){idx--;render();}};document.getElementById('next').onclick=()=>{if(!answers.find(a=>a.id===q.id))return;idx++;render();};}
    render();

  }catch(e){showErr('Init error: '+(e&&e.stack?e.stack:e));}
})();
</script>
</body></html>
