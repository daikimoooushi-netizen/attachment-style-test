<!doctype html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>4段階愛着診断</title>
<style>
  :root{
    --rose50:#fff1f2; --rose100:#ffe4e6; --rose200:#fecdd3; --rose300:#fda4af;
    --rose400:#fb7185; --rose500:#f43f5e; --rose600:#e11d48;
    --text:#7f1d1d; --ink:#334155; --muted:#64748b;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font-family:system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Kaku Gothic ProN", YuGothic, "Yu Gothic", Meiryo, sans-serif;
    background:linear-gradient(#fff,#fff) padding-box,
               repeating-linear-gradient(0deg,var(--rose50),var(--rose50) 80px,#fff 80px,#fff 160px);
    color:var(--ink);
  }
  .wrap{max-width:860px; margin:0 auto; padding:24px;}
  h1{margin:8px 0 18px; font-size:28px; text-align:center; color:var(--rose700,#be123c)}
  .sub{color:var(--muted); text-align:center; font-size:12px; margin-bottom:10px;}
  .row{display:flex; gap:12px; align-items:center; justify-content:space-between}
  .card{
    background:#fff; border:1px solid var(--rose200); border-radius:18px; padding:18px 14px; box-shadow:0 1px 6px rgba(0,0,0,.05);
  }
  .muted{color:var(--muted)}
  .head{font-weight:700; color:var(--rose600)}
  .q{font-weight:700; color:var(--rose700,#be123c); font-size:22px; line-height:1.6; margin:6px 2px 12px}
  .choice{border:1px solid var(--rose200); border-radius:14px; padding:14px 14px; text-align:left; background:#fff; cursor:pointer}
  .choice:hover{border-color:var(--rose300)}
  .choice.selected{border-color:var(--rose400); background:var(--rose50)}
  .btn{border:none; border-radius:12px; padding:10px 16px; font-weight:600; cursor:pointer; color:#fff; background:var(--rose500)}
  .btn:disabled{background:#fecaca; cursor:not-allowed}
  .btn-ghost{background:#fff; color:var(--rose600); border:1px solid var(--rose200)}
  .progress{height:10px; background:var(--rose100); border-radius:999px; overflow:hidden}
  .progress > div{height:100%; background:var(--rose400); width:0%}
  .foot-note{font-size:11px; color:var(--muted); text-align:center; margin-top:10px}
  @media (max-width:640px){ .wrap{padding:16px} .q{font-size:20px} }
</style>
</head>
<body>
  <div class="wrap">
    <h1>4段階愛着診断</h1>

    <!-- 進捗カード -->
    <div id="bar" class="card" style="margin-bottom:14px;">
      <div class="row" style="margin-bottom:6px">
        <div class="muted">進捗</div>
        <div class="muted" id="counter">0/0 (0%)</div>
      </div>
      <div class="progress"><div id="barfill"></div></div>
    </div>

    <!-- 質問カード -->
    <div id="qcard" class="card">
      <div class="muted head" id="stageTitle"></div>
      <div class="q" id="stem"></div>
      <div id="choices" class="col" style="display:grid; gap:10px; margin-top:8px"></div>

      <div class="row" style="margin-top:16px">
        <button id="prev" class="btn btn-ghost">戻る</button>
        <div class="muted" id="warn">未回答のまま次へは進めません</div>
        <button id="next" class="btn" disabled>次へ</button>
      </div>
    </div>

    <div class="foot-note" id="tip" style="display:none"></div>
  </div>

<script>
/* ------------------------------
   第2段階（S2）20問・第3段階（S3）20問
   A→D が下に行くほど安定・改善
-------------------------------- */
const S2 = [
  {id:"s2-01",stage:2,stageTitle:"第2段階：成長・改善度（昔と今の比較）",stem:"愛着を意識する前と比べて、不安を感じる頻度はどう変わりましたか？",choices:[
    {id:"A",label:"ほとんど変わらない／よく不安になる"},
    {id:"B",label:"少しは減った"},
    {id:"C",label:"かなり減った"},
    {id:"D",label:"めったに不安にならない"}]},
  {id:"s2-02",stage:2,stageTitle:"第2段階：成長・改善度（昔と今の比較）",stem:"昔と比べて、恋愛中に相手を信じられる度合いは？",choices:[
    {id:"A",label:"ほぼ変化なし／疑いがち"},
    {id:"B",label:"少し信じられるようになった"},
    {id:"C",label:"かなり信じられるようになった"},
    {id:"D",label:"基本的に信頼できている"}]},
  {id:"s2-03",stage:2,stageTitle:"第2段階：成長・改善度（昔と今の比較）",stem:"不安になったとき、落ち着くまでの時間は？",choices:[
    {id:"A",label:"以前と同じ／長引く"},
    {id:"B",label:"少し短くなった"},
    {id:"C",label:"かなり短くなった"},
    {id:"D",label:"すぐ整えられる"}]},
  {id:"s2-04",stage:2,stageTitle:"第2段階：成長・改善度（昔と今の比較）",stem:"相手に素直に気持ちを伝えられるようになりましたか？",choices:[
    {id:"A",label:"ほぼ変化なし／言えない"},
    {id:"B",label:"少し言えるようになった"},
    {id:"C",label:"かなり言えるようになった"},
    {id:"D",label:"落ち着いて率直に伝えられる"}]},
  {id:"s2-05",stage:2,stageTitle:"第2段階：成長・改善度（昔と今の比較）",stem:"依存的な行動（追撃LINEなど）は減りましたか？",choices:[
    {id:"A",label:"今もよくやってしまう"},
    {id:"B",label:"少し減った"},
    {id:"C",label:"かなり減った"},
    {id:"D",label:"ほぼ無くなった"}]},

  {id:"s2-06",stage:2,stageTitle:"第2段階：成長・改善度（現在の対処力）",stem:"好きな人から3日連絡がなかったら、今のあなたは？",choices:[
    {id:"A",label:"我慢できず連絡を連投してしまう"},
    {id:"B",label:"連絡したくなるが何とか抑えられる"},
    {id:"C",label:"気になるが自分を落ち着けて待てる"},
    {id:"D",label:"状況を捉え直し落ち着いて待てる"}]},
  {id:"s2-07",stage:2,stageTitle:"第2段階：成長・改善度（現在の対処力）",stem:"相手に『一人の時間が欲しい』と言われたら？",choices:[
    {id:"A",label:"不安で詰めてしまう"},
    {id:"B",label:"不安だが一旦受け止められる"},
    {id:"C",label:"相手の意図を確かめ落ち着ける"},
    {id:"D",label:"自然に尊重し自分の時間を大切にできる"}]},
  {id:"s2-08",stage:2,stageTitle:"第2段階：成長・改善度（現在の対処力）",stem:"ケンカしたとき、今のあなたは？",choices:[
    {id:"A",label:"感情的にぶつかる／無視する"},
    {id:"B",label:"一呼吸おいて話せることもある"},
    {id:"C",label:"落ち着いて話し合いに戻せる"},
    {id:"D",label:"合意形成まで運べることが多い"}]},
  {id:"s2-09",stage:2,stageTitle:"第2段階：成長・改善度（現在の対処力）",stem:"相手が他の異性と仲良くしているのを見たら？",choices:[
    {id:"A",label:"強い嫉妬／詰める／距離を取る"},
    {id:"B",label:"不安だがその場は流せる"},
    {id:"C",label:"後で冷静に気持ちを共有できる"},
    {id:"D",label:"信頼を前提に丁寧に対話できる"}]},
  {id:"s2-10",stage:2,stageTitle:"第2段階：成長・改善度（現在の対処力）",stem:"不安が出ても自分で落ち着ける方法は？",choices:[
    {id:"A",label:"ほとんど無い"},
    {id:"B",label:"いくつかあるが時々崩れる"},
    {id:"C",label:"十分ある／多くは整えられる"},
    {id:"D",label:"確立していて再現性が高い"}]},

  {id:"s2-11",stage:2,stageTitle:"第2段階：成長・改善度（自立・継続）",stem:"誰にも相談できないときでも、冷静さを保てる自信は？",choices:[
    {id:"A",label:"自信がない"},
    {id:"B",label:"状況次第"},
    {id:"C",label:"ほぼ保てる"},
    {id:"D",label:"十分に保てる"}]},
  {id:"s2-12",stage:2,stageTitle:"第2段階：成長・改善度（自立・継続）",stem:"恋愛以外（仕事・趣味）を大切にできていますか？",choices:[
    {id:"A",label:"できていない"},
    {id:"B",label:"少し意識できる"},
    {id:"C",label:"概ねできている"},
    {id:"D",label:"安定してできている"}]},
  {id:"s2-13",stage:2,stageTitle:"第2段階：成長・改善度（自立・継続）",stem:"相手がいなくても『自分には価値がある』と思える？",choices:[
    {id:"A",label:"あまり思えない"},
    {id:"B",label:"時々思える"},
    {id:"C",label:"だいたい思える"},
    {id:"D",label:"しっかり思えている"}]},
  {id:"s2-14",stage:2,stageTitle:"第2段階：成長・改善度（自立・継続）",stem:"恋愛がなくても、生活や気持ちは安定している？",choices:[
    {id:"A",label:"不安定になりがち"},
    {id:"B",label:"やや不安定"},
    {id:"C",label:"おおむね安定"},
    {id:"D",label:"安定している"}]},
  {id:"s2-15",stage:2,stageTitle:"第2段階：成長・改善度（自立・継続）",stem:"ふとしたときに『恋愛がなくても幸せ』と思える？",choices:[
    {id:"A",label:"ほぼ無い"},
    {id:"B",label:"時々ある"},
    {id:"C",label:"よくある"},
    {id:"D",label:"自然に感じられる"}]},

  {id:"s2-16",stage:2,stageTitle:"第2段階：成長・改善度（深層・本音）",stem:"頭では『大丈夫』と思っていても、心では不安になることは？",choices:[
    {id:"A",label:"よくある"},
    {id:"B",label:"時々ある"},
    {id:"C",label:"まれにある"},
    {id:"D",label:"ほとんど無い"}]},
  {id:"s2-17",stage:2,stageTitle:"第2段階：成長・改善度（深層・本音）",stem:"知識では理解していても、恋愛で不安がぶり返す？",choices:[
    {id:"A",label:"よくぶり返す"},
    {id:"B",label:"時々ぶり返す"},
    {id:"C",label:"たまにある"},
    {id:"D",label:"ほぼ無い"}]},
  {id:"s2-18",stage:2,stageTitle:"第2段階：成長・改善度（深層・本音）",stem:"『冷静でいよう』と思っても、同じ行動を繰り返す？",choices:[
    {id:"A",label:"よく繰り返す"},
    {id:"B",label:"時々ある"},
    {id:"C",label:"かなり減った"},
    {id:"D",label:"ほぼ無い"}]},
  {id:"s2-19",stage:2,stageTitle:"第2段階：成長・改善度（深層・本音）",stem:"うまくいかないとき、自分を責めてしまう？",choices:[
    {id:"A",label:"よく責める"},
    {id:"B",label:"時々責める"},
    {id:"C",label:"たまにある"},
    {id:"D",label:"ほとんど無い"}]},
  {id:"s2-20",stage:2,stageTitle:"第2段階：成長・改善度（深層・本音）",stem:"『成長したはずなのに、恋愛すると揺らぐ』と感じる？",choices:[
    {id:"A",label:"よく感じる"},
    {id:"B",label:"時々感じる"},
    {id:"C",label:"まれに感じる"},
    {id:"D",label:"ほとんど感じない"}]},
];

const S3 = [
  {id:"s3-01",stage:3,stageTitle:"第3段階：改善の安定度（高ストレス反応）",stem:"好きな人から3日間連絡がなかったら？",choices:[
    {id:"A",label:"我慢できず何度も送る／電話する"},
    {id:"B",label:"落ち込みやすいが一旦待てる"},
    {id:"C",label:"不安を整えて様子を見る"},
    {id:"D",label:"状況を捉え直し落ち着いて待てる"}]},
  {id:"s3-02",stage:3,stageTitle:"第3段階：改善の安定度（高ストレス反応）",stem:"『少し距離を置きたい』と言われたら？",choices:[
    {id:"A",label:"パニックで詰める／連投する"},
    {id:"B",label:"冷めたフリ／駆け引きをする"},
    {id:"C",label:"不安はあるが落ち着ける"},
    {id:"D",label:"尊重し自分の時間を整えられる"}]},
  {id:"s3-03",stage:3,stageTitle:"第3段階：改善の安定度（高ストレス反応）",stem:"相手が元カノ・元カレの話をしたとき？",choices:[
    {id:"A",label:"問い詰める／不機嫌に当たる"},
    {id:"B",label:"黙り込む／距離を取る"},
    {id:"C",label:"後で落ち着いて共有できる"},
    {id:"D",label:"信頼を前提に対話できる"}]},
  {id:"s3-04",stage:3,stageTitle:"第3段階：改善の安定度（高ストレス反応）",stem:"相手が急に冷たい態度になったと感じたら？",choices:[
    {id:"A",label:"理由確認を連発／感情的になる"},
    {id:"B",label:"投げやりになって距離を置く"},
    {id:"C",label:"一呼吸おいて落ち着く"},
    {id:"D",label:"タイミングを見て冷静に話せる"}]},
  {id:"s3-05",stage:3,stageTitle:"第3段階：改善の安定度（高ストレス反応）",stem:"不安で眠れなくなることは？",choices:[
    {id:"A",label:"よくある"},{id:"B",label:"時々ある"},{id:"C",label:"たまにある"},{id:"D",label:"ほとんど無い"}]},

  {id:"s3-06",stage:3,stageTitle:"第3段階：改善の安定度（一人での対処）",stem:"相談できない状況で不安になったら？",choices:[
    {id:"A",label:"感情に飲まれる／衝動的に連絡"},
    {id:"B",label:"我慢して苦しみ続ける"},
    {id:"C",label:"セルフケアで落ち着ける"},
    {id:"D",label:"客観視して行動を選べる"}]},
  {id:"s3-07",stage:3,stageTitle:"第3段階：改善の安定度（一人での対処）",stem:"恋人がいない期間でも気持ちは安定している？",choices:[
    {id:"A",label:"不安定になりやすい"},
    {id:"B",label:"やや不安定"},
    {id:"C",label:"おおむね安定"},
    {id:"D",label:"安定している"}]},
  {id:"s3-08",stage:3,stageTitle:"第3段階：改善の安定度（一人での対処）",stem:"誰にも頼れないとき、自分で落ち着ける方法が？",choices:[
    {id:"A",label:"ほとんど無い"},{id:"B",label:"あるが不安定"},{id:"C",label:"十分ある"},{id:"D",label:"再現性高く使える"}]},
  {id:"s3-09",stage:3,stageTitle:"第3段階：改善の安定度（一人での対処）",stem:"休日を一人で過ごすと、恋愛のことばかり考える？",choices:[
    {id:"A",label:"よくある"},{id:"B",label:"時々ある"},{id:"C",label:"たまにある"},{id:"D",label:"ほとんど無い"}]},
  {id:"s3-10",stage:3,stageTitle:"第3段階：改善の安定度（一人での対処）",stem:"SNSで不安になることは？",choices:[
    {id:"A",label:"よくある"},{id:"B",label:"時々ある"},{id:"C",label:"たまにある"},{id:"D",label:"ほとんど無い"}]},

  {id:"s3-11",stage:3,stageTitle:"第3段階：改善の安定度（再発リスク）",stem:"恋愛が始まると、昔の不安なパターンに戻る？",choices:[
    {id:"A",label:"よく戻る"},{id:"B",label:"時々戻る"},{id:"C",label:"まれに戻る"},{id:"D",label:"ほとんど無い"}]},
  {id:"s3-12",stage:3,stageTitle:"第3段階：改善の安定度（再発リスク）",stem:"相手を疑ってしまう気持ちは？",choices:[
    {id:"A",label:"強く出やすい"},{id:"B",label:"時々出る"},{id:"C",label:"まれに出る"},{id:"D",label:"ほとんど出ない"}]},
  {id:"s3-13",stage:3,stageTitle:"第3段階：改善の安定度（再発リスク）",stem:"ケンカのとき感情的になりやすい？",choices:[
    {id:"A",label:"なりやすい"},{id:"B",label:"時々ある"},{id:"C",label:"あまり無い"},{id:"D",label:"ほぼ無い"}]},
  {id:"s3-14",stage:3,stageTitle:"第3段階：改善の安定度（再発リスク）",stem:"不安を感じるとき、自分の価値を疑ってしまう？",choices:[
    {id:"A",label:"よく疑う"},{id:"B",label:"時々疑う"},{id:"C",label:"たまにある"},{id:"D",label:"ほとんど無い"}]},
  {id:"s3-15",stage:3,stageTitle:"第3段階：改善の安定度（再発リスク）",stem:"『もう大丈夫』と思っても、恋愛中に揺らぐ？",choices:[
    {id:"A",label:"よく揺らぐ"},{id:"B",label:"時々揺らぐ"},{id:"C",label:"まれに揺らぐ"},{id:"D",label:"ほとんど揺らがない"}]},

  {id:"s3-16",stage:3,stageTitle:"第3段階：改善の安定度（安定の再現性）",stem:"不安をぶつけそうになっても、落ち着けることが増えた？",choices:[
    {id:"A",label:"あまり増えていない"},{id:"B",label:"少し増えた"},{id:"C",label:"かなり増えた"},{id:"D",label:"安定してできる"}]},
  {id:"s3-17",stage:3,stageTitle:"第3段階：改善の安定度（安定の再現性）",stem:"一度落ち着けば、その後も安定を保ちやすい？",choices:[
    {id:"A",label:"保てないことが多い"},{id:"B",label:"状況次第"},{id:"C",label:"だいたい保てる"},{id:"D",label:"保てる自信がある"}]},
  {id:"s3-18",stage:3,stageTitle:"第3段階：改善の安定度（安定の再現性）",stem:"不安を感じたとき、以前より冷静に話し合える？",choices:[
    {id:"A",label:"あまり変化なし"},{id:"B",label:"少しは話せる"},{id:"C",label:"かなり話せる"},{id:"D",label:"落ち着いて話し合える"}]},
  {id:"s3-19",stage:3,stageTitle:"第3段階：改善の安定度（安定の再現性）",stem:"強い嫉妬や不安が出ても、自分で修正できる？",choices:[
    {id:"A",label:"ほぼできない"},{id:"B",label:"時々できる"},{id:"C",label:"多くはできる"},{id:"D",label:"安定してできる"}]},
  {id:"s3-20",stage:3,stageTitle:"第3段階：改善の安定度（安定の再現性）",stem:"『安定した恋愛を続けられる自信』は？",choices:[
    {id:"A",label:"あまり無い"},{id:"B",label:"ややある"},{id:"C",label:"かなりある"},{id:"D",label:"十分ある"}]},
];

/* いまは S2 + S3 で稼働。S1/S4 を足す時は配列に追加するだけ */
const QUESTIONS = [...S2, ...S3];

/* ------------------------------
   シンプル UI 制御
-------------------------------- */
const els = {
  counter: document.getElementById('counter'),
  barfill: document.getElementById('barfill'),
  qcard: document.getElementById('qcard'),
  stageTitle: document.getElementById('stageTitle'),
  stem: document.getElementById('stem'),
  choices: document.getElementById('choices'),
  prev: document.getElementById('prev'),
  next: document.getElementById('next'),
  warn: document.getElementById('warn'),
};

let idx = 0;
const answers = new Map(); // questionId -> "A" | "B" | "C" | "D"

function render(){
  const total = QUESTIONS.length;
  const percent = Math.round((idx+1) / total * 100);
  els.counter.textContent = `${idx+1}/${total} (${percent}%)`;
  els.barfill.style.width = `${percent}%`;

  const q = QUESTIONS[idx];
  els.stageTitle.textContent = q.stageTitle ?? `第${q.stage}段階`;
  els.stem.textContent = q.stem;

  els.choices.innerHTML = "";
  const selected = answers.get(q.id);
  q.choices.forEach(c=>{
    const b = document.createElement('button');
    b.className = 'choice' + (selected===c.id ? ' selected' : '');
    b.textContent = c.label;
    b.onclick = ()=>{
      answers.set(q.id, c.id);
      Array.from(els.choices.children).forEach(x=>x.classList.remove('selected'));
      b.classList.add('selected');
      els.next.disabled = false;
      els.warn.style.visibility = 'hidden';
    };
    els.choices.appendChild(b);
  });

  els.prev.disabled = idx===0;
  els.next.textContent = idx===total-1 ? '結果を見る' : '次へ';
  els.next.disabled = !selected;
  els.warn.style.visibility = selected ? 'hidden' : 'visible';
}

els.prev.onclick = ()=>{
  if(idx>0){ idx--; render(); }
};
els.next.onclick = ()=>{
  const q = QUESTIONS[idx];
  if(!answers.get(q.id)){ els.warn.style.visibility='visible'; return; }
  if(idx < QUESTIONS.length-1){ idx++; render(); }
  else { showResult(); }
};

function showResult(){
  // まずはプレースホルダの完了画面（集計は次の段で実装）
  const total = QUESTIONS.length;
  const answered = answers.size;
  els.qcard.innerHTML = `
    <div class="q" style="font-size:20px; color:var(--ink); margin-top:4px">回答ありがとうございます。</div>
    <div class="muted" style="margin:8px 0 14px">合計 ${answered}/${total} 問に回答しました。</div>
    <div class="card" style="border-style:dashed">
      <div style="font-weight:700; color:var(--rose600); margin-bottom:8px">次の一手</div>
      <div class="muted" style="line-height:1.8">
        ・第1段階（S1）と第4段階（S4）の設問を追加 → レーダー集計<br/>
        ・第2段階＝改善度％、第3段階＝ストレス耐性ラベルを結果に表示
      </div>
    </div>
    <div class="row" style="margin-top:16px; justify-content:flex-end">
      <button class="btn btn-ghost" id="restart">最初からやり直す</button>
    </div>
  `;
  document.getElementById('restart').onclick = ()=>{
    answers.clear(); idx = 0; location.reload();
  };
}

/* 初期表示 */
render();
</script>
</body>
</html>
